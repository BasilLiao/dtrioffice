<div class="row border" id="bom_type_item_body">
	<div class="col-md-12 border">
		<!-- 功能: 查詢 /新增 /修改 -->
		<div class="mt-3 mb-3 border">
			<div class="mb-3">
				<h3>
					<b>建立 BOM 項目功能</b>
				</h3>
			</div>
			<!-- 查詢功能 -->
			<div class="mb-3 border border-primary shadow bg-light">
				<div class="row mb-2">
					<div class="col-md-5">
						<a class="btn btn-sm btn-success" data-toggle="collapse" href="#collapseSearch" role="button" aria-expanded="true" aria-controls="collapseSearch"> 查詢功能 : </a>
					</div>
				</div>
				<div class="collapse show" id="collapseSearch">
					<div class="col-md-12 mb-5">
						<div class="row">
							<div class="col-md-4 h5">
								<div class="row">
									<div class="col-md-12 text-left">
										項目群組名稱 : <select class="md-12 a_row2" id="s_group_name" name="s_group_name"></select>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row mb-3">
						<div class="col-md-5"></div>
						<div class="col-md-2">
							<div class="col-md-10">
								<button id="s_submit" class="col-md-12 btn btn-primary btn-block" type="submit">查詢</button>
							</div>
						</div>
						<div class="col-md-5"></div>
					</div>
				</div>
			</div>
			<!-- 功能:查詢結果  /修改 -->
			<div class="mb-3 border border-primary shadow bg-light">
				<div class="border">
					<div class="row mb-2">
						<div class="col-md-5">
							<a class="btn btn-sm btn-success" data-toggle="collapse" href="#collapseFinish" role="button" aria-expanded="true" aria-controls="collapseFinish"> 查詢結果 : </a>
						</div>
					</div>
					<div class="collapse show" id="collapseFinish">
						<div class="col-md-12">
							<div id="search_choose" class="row mb-2">
								<div class="text-left">
									<b>顯示名稱-></b>
								</div>
							</div>
							<div class="row mb-2">
								<b style="color: red;">注意:"最多50個"項目組</b>
							</div>
							<!-- 顯示內容 -->
							<div class="row">
								<table style="min-height: 480px;" class="table table-sm table-hover table-striped table-bordered table-responsive">
									<thead>
										<tr id="search_thead" class="bg-primary h5">
											<th scope="col" style="min-width: 90px;">功能</th>
											<th scope="col" style="min-width: 40px;">筆</th>
										</tr>
									</thead>
									<tbody id="search_tbody"></tbody>
								</table>
							</div>
							<div aria-label="Page">
								<ul class="pagination justify-content-center">
									<li class="page-item p_p disabled"><a id="p_p" class="page-link" href="#" onclick="return templateBody.change_page(this);">Previous 10 </a></li>
									<li class="page-item p_nb p1 active"><a id="p1" class="page-link" href="#" onclick="return templateBody.change_page(this);">1</a></li>
									<li class="page-item p_nb p2"><a id="p2" class="page-link" href="#" onclick="return templateBody.change_page(this);">2</a></li>
									<li class="page-item p_nb p3"><a id="p3" class="page-link" href="#" onclick="return templateBody.change_page(this);">3</a></li>
									<li class="page-item p_nb p4"><a id="p4" class="page-link" href="#" onclick="return templateBody.change_page(this);">4</a></li>
									<li class="page-item p_nb p5"><a id="p5" class="page-link" href="#" onclick="return templateBody.change_page(this);">5</a></li>
									<li class="page-item p_nb p6"><a id="p6" class="page-link" href="#" onclick="return templateBody.change_page(this);">6</a></li>
									<li class="page-item p_nb p7"><a id="p7" class="page-link" href="#" onclick="return templateBody.change_page(this);">7</a></li>
									<li class="page-item p_nb p8"><a id="p8" class="page-link" href="#" onclick="return templateBody.change_page(this);">8</a></li>
									<li class="page-item p_nb p9"><a id="p9" class="page-link" href="#" onclick="return templateBody.change_page(this);">9</a></li>
									<li class="page-item p_nb p10"><a id="p10" class="page-link" href="#" onclick="return templateBody.change_page(this);">10</a></li>
									<li class="page-item p_n disabled"><a id="p_n" class="page-link" href="#" onclick="return templateBody.change_page(this);">Next 10 </a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 新增/修改功能 -->
			<div class="border border-primary shadow bg-light">
				<div class="row mb-2">
					<div class="col-md-5">
						<a class="btn btn-sm btn-success" data-toggle="collapse" href="#collapseAdded" role="button" aria-expanded="true" aria-controls="collapseAdded"> 新增/修改/刪除 功能 : </a>
					</div>
				</div>
				<form onsubmit="return templateBody.send_added_or_update_save();">
					<div class="collapse show" id="collapseAdded">
						<!-- 新增 或 修改(分辨) -->
						<div class="row m-0 mb-1 h5">
							<div class="col-md-3">
								<div class="row text-left">
									<div class="col-md-6 pr-0 ">狀態 :</div>
									<div class="col-md-6 pr-0" id="a_u_type" style="font-size: 25px; color: red;">新增資料</div>
								</div>
							</div>
							<div class="col-md-3">
								<div class="row text-left">
									<div class="col-md-6 pr-0 ">GroupID:</div>
									<div class="col-md-6 pr-0" id="a_u_group_id">0</div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="row text-left">
									<div class="col-md-3 pr-0 ">Group(項目組):</div>
									<div class="col-md-9 " id="">
										<input class="col-md-12 mr-2" type="text" id="a_u_group_name" placeholder="Ex:項目組 分類名稱" value="" required />
									</div>
								</div>
							</div>
							<div class="col-md-3 mt-1">
								<div class="row text-left">
									<div class="col-md-6 pr-0 ">Type(類型):</div>
									<div class="col-md-6 " id="a_u_group_type">
										<select class="col-md-12" required>
											<option value="">請選擇</option>
											<option value="1">checkbox</option>
											<option value="2" selected>select</option>
										</select>
									</div>
								</div>
							</div>
							<div class="col-md-3 mt-1" title="越大越前面">
								<div class="row text-left">
									<div class="col-md-6 pr-0 ">Sort(排序):</div>
									<div class="col-md-6">
										<input class="col-md-12 mr-2" type="text" id="a_u_type_order" placeholder="Ex:12" value="" required />
									</div>
								</div>
							</div>
							<div class="col-md-3 mt-1">
								<div class="row text-left">
									<div class="col-md-6 pr-0 ">Must(必填?):</div>
									<div class="col-md-6">
										<input class="" type="checkbox" value="true" id="a_u_group_checkdf" checked style="height: 25px; width: 25px;" />
									</div>
								</div>
							</div>
						</div>
						<div class="dropdown-divider" style="border-top: 1px solid green;"></div>
						<!-- 新增 或 修改 或 刪除(內容) -->
						<!-- 顯示權限 內容 -->
						<div class="col-md-12">
							<div class="row">
								<table class="table table-sm table-hover table-striped table-bordered table-responsive">
									<thead class="" style="border: 3px solid #6a7b7e;">
										<tr id="item_thead_title" class="bg-primary">
											<th class="h5 font-weight-bold" scope="col" style="min-width: 60px;">類型</th>
											<th class="h5 font-weight-bold" scope="col" style="min-width: 100px;">功能</th>
											<th class="h5 font-weight-bold" scope="col" style="min-width: 70px;">ID</th>
											<th class="h5 font-weight-bold" scope="col" style="min-width: 250px;">備註說明</th>
											<th class="h5 font-weight-bold" scope="col" id="item_lists" style="min-width: 60px; width: 100%;" colspan="25">BOM項目清單-(i01-i25) 最多25項目</th>
										</tr>
										<tr id="item_thead" class="bg-white"></tr>
									</thead>
									<tbody id="item_tbody"></tbody>
								</table>
							</div>
						</div>
						<div class="row mb-3">
							<div class="col-md-4"></div>
							<div class="col-md-2">
								<div class="col-md-10">
									<button id="a_u_submit" class="btn btn-primary btn-block" type="submit">存入資料</button>
								</div>
							</div>
							<div class="col-md-2">
								<div class="col-md-10">
									<button id="a_c_submit" class="btn btn-warning btn-block" type="button">清除內容</button>
								</div>
							</div>
							<div class="col-md-4"></div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
    console.log("bom_type_item_body");
    templateBody = new Vue({
        el: "#bom_type_item_body",
        data: {
            search_list: "", //項目名稱
            search_item: "", //內容
            now_column_n: 0, //當前選擇的 行數
            now_row_n: 0, //當前選擇的  筆數
          	//分頁功能
			page_max : 100,//當前本批 筆數
			page_max_total : 100,//最大總數
			page_batch : 0,//第幾批
			page_batch_total : 100,//每批間格值
			page_every : 10,//當前每頁筆數
			page_stay : 1,//當前頁數
			s_4:0,//當前產品ID
			d_1:'',//當前的 投線日
			d_2:'',//當前的 出貨日
        },
        created: function () {
            //初始化
            console.log(main.contentData.templateInfo.body["list"]);
            this.search_list = main.contentData.templateInfo.body["list"]["group_list"];
            this.search_item = main.contentData.templateInfo.body["list"]["item_list"];
            //t_choose
            var min_width = 100;
            for (var i = 0; i < this.search_list[0].length; i++) {
                var choose_check = '[<div class="text-left form-check">';
                choose_check += '<input class="form-check-input" type="checkbox" value="" id="s_' + i + '" checked>';
                choose_check += '<label class="form-check-label" for="s_' + i + '">' + this.search_list[0][i] + "</label>";
                choose_check += "</div>]";
                $("#search_choose").append(choose_check);
            }
            //t_header
            for (var i = 0; i < this.search_list[0].length; i++) {
                if (i == 7 || i == 9 || i == 11) {
                    min_width = 180;
                }
                $("#search_thead").append('<th style="min-width: ' + min_width + 'px;" class="s_' + i + '" scope="col">' + this.search_list[0][i] + "</th>");
                min_width = 100;
            }
            $('#search_thead .s_5').css('width','100%');
            //t_body
            this.search_update();
            //可查  查詢 群組
            this.group_search();
            //新增 預設
            this.added_item(0);

            //動態監聽顯示Table 物件 查看開關
            $(document).on("click", "#search_choose input", function (event) {
                templateBody.search_choose(event);
            });
            //查詢監聽
            $(document).on("click", "#s_submit", function (event) {
            	//頁數-重製分頁
				templateBody.change_page_init();
                templateBody.send_search();
            });
            //清除修改
            $(document).on("click", "#a_c_submit", function (event) {
                templateBody.rm_added();
            });
        },
        methods: {
            search_choose: function (event) {
                // console.log(event.target.checked);
                if (!event.target.checked) {
                    $("#search_thead ." + event.target.id).hide();
                    $("#search_tbody ." + event.target.id).hide();
                } else {
                    $("#search_thead ." + event.target.id).show();
                    $("#search_tbody ." + event.target.id).show();
                }
            },
            //--------------查詢更新--------------
            search_update: function () {
                $("#search_tbody").empty();
              	//頁數-刷新
				this.change_page_update();
                //t_body
                for (var i = 1; i < this.search_list.length; i++) {
                	//頁數-每頁顯示(不再顯示範圍內則隱藏)
					var page_group = this.change_page_btn(i);
                    //功能
                    var s_list = this.search_list[i][0];

                    var a_submit = '<div class="md-6">';
                    a_submit += '<button user_id="' + s_list + '" class="btn btn-warning btn-sm btn-block a_submit">';
                    a_submit += "改</button></div>";

                    var d_submit = '<div class="md-6 ml-1">';
                    d_submit += '<button user_id="' + s_list + '" class="btn btn-danger btn-sm btn-block d_submit">';
                    d_submit += "刪</button></div>";

                    $("#search_tbody").append('<tr class="page_all t_row' + s_list + ' '+page_group+'" style="white-space: nowrap;"><th class="ml-0 col-md-12 row">' + a_submit + d_submit + "</th></tr>");
                    //計數量
                    $("#search_tbody .t_row" + s_list).append("<td >" + i + "</td>");

                    for (var j = 0; j < this.search_list[i].length; j++) {
                        $("#search_tbody .t_row" + s_list).append("<td class=s_" + j + ">" + this.search_list[i][j] + "</td>");
                    }
                }
                //修改監聽
                $(document).on("click", ".a_submit", function (event) {
                    templateBody.choose_update("修改資料", event);
                });
                //刪除監聽
                $(document).on("click", ".d_submit", function (event) {
                    templateBody.choose_delete(event);
                });
            },

            //選擇群組-並建立監聽
            group_search: function () {
                var group = "";
                $("#s_group_name").empty();
                group += '<option value="">請選擇</option>';
                $.each(this.search_list, function (index, val) {
                    if (index > 0) {
                        group += "<option value=" + val[1] + ">" + val[1] + "</option>";
                    }
                });
                $("#s_group_name").append(group);
            },
            //清除新增/修該內容
            rm_added: function () {
                $("#a_u_type").text("新增資料");
                $("#a_u_group_name").val("");
                $("#a_u_group_note").val("");
                $("#a_u_type_order").val("1");
                
                $("#a_u_group_id").text("0");
                $("#a_u_group_type select").val("2");
                $("#a_u_group_checkdf").prop("checked", true);

                this.choose_disabled(false);
                //新增 預設
                this.added_item(0);
            },
            //選擇  修改
            choose_update: function (a_u_type, event) {
            	this.rm_id = [];//移除 清空
                var id = event.target.attributes.user_id.value;

                $("#a_u_group_id").text($(".t_row" + id + " .s_0")[0].innerText);
                $("#a_u_group_name").val($(".t_row" + id + " .s_1")[0].innerText);
                $("#a_u_group_type select").val($(".t_row" + id + " .s_2")[0].innerText.split("=")[0]);
                if($(".t_row" + id + " .s_3")[0].innerText=='true'){
	                $("#a_u_group_checkdf").prop("checked", true);            	
                }else{
                	 $("#a_u_group_checkdf").prop("checked", false);     
                }

                $("#a_u_type").text(a_u_type);
                $("#a_u_type_order").val($(".t_row" + id + " .s_4")[0].innerText);

                // a_u_group_name
                this.choose_disabled(false);
                //新增欄位
                this.added_item($(".t_row" + id + " .s_0")[0].innerText);
                //移動
                setTimeout(function() {
					$("html,body").animate({
						scrollTop : 900
					}, 'slow');
				}, 200);
            },
            //選擇 刪除
            choose_delete: function (event) {
                var id = event.target.attributes.user_id.value;
                var a_u_type = "移除資料";
                $("#a_u_type").text(a_u_type);
                $("#a_u_id").text($(".t_row" + id + " .s_4")[0].innerText);
                $("#a_u_group").text($(".t_row" + id + " .s_6")[0].innerText);

                this.choose_update(a_u_type, event);
                this.choose_disabled("disabled");
                //移動
                setTimeout(function() {
					$("html,body").animate({
						scrollTop : 900
					}, 'slow');
				}, 500);
            },
            //鎖定資料
            choose_disabled: function (disabled) {
                $("#a_u_group_name").attr("disabled", disabled);
                $("#a_u_group_note").attr("disabled", disabled);
                $("#a_u_type_order").attr("disabled", disabled);
                $("#a_u_group_type select").attr("disabled", disabled);
                $("#item_tbody tr td input").attr("disabled", disabled);
                $("#item_tbody tr td button").attr("disabled", disabled);
                $("#item_thead th div input").attr("disabled", disabled);
                $("#item_thead th div button").attr("disabled", disabled);
            },
            //--------------新增 項目物件 number(目前欄位)--------------
            added_item: function (id) {
                $("#item_thead").empty();
                $("#item_tbody").empty();
                var size_item = 0; //欄位數
                var item_name = []; //欄位名稱
                var item_value = [[]]; //指定的欄位與內容
                var size_list = 0; //筆數
                if (id > 0) {
                    //有指定ID的話->修改欄位數
                    for (var i = 0; i < this.search_item.length; i++) {
                        if (this.search_item[i][0] == id) {
                            if (this.search_item[i][2] == 1) {
                                size_item = this.search_item[i].length;
                                item_name = this.search_item[i];
                            }
                            item_value[size_list] = this.search_item[i];
                            size_list++;
                        }
                    }
                } else {
                    item_name[0] = "";
                }
                //t_header

                //欄位數
                var t_p_row1 = '<th scope="col">項目</th>';
                //欄位項目+按鈕
                var div_item = "";

                div_item += '<div class =" ml-0 mr-0">';
                div_item += '<button id="a_n_submit" class="btn btn-success btn-sm btn-block a_n_submit"  type="button">添加項目</button>';
                div_item += "</div>";
                t_p_row1 += '<th scope="col" >' + div_item + "</th>";
                if (size_item > 0) {
                    //欄位項目(有指定內容)
                    //ID
                    div_item = "";
                  	div_item = '<div class ="row ml-0 mr-0" id="name_v_1">' + item_name[2] + '</div>';
                  	t_p_row1 += '<th scope="col" class="column_1" >' + div_item + "</th>";
                  	//備註
                  	div_item = "";
                  	div_item = '<div class ="row ml-0 mr-0" id="name_v_2">';
                	div_item +='<input class="col-md-12" type="text" value="' + item_name[3] + '"  placeholder="Ex:項目備註" required/></div>';
                  	t_p_row1 +='<th scope="col" class="column_2" >' + div_item + "</th>";
                  	
                    for (var j = 4; j < size_item; j++) {
                        div_item = "";
                        div_item += '<div class ="row ml-0 mr-0">';
                        div_item += '<input class="col-md-8  mr-2" type="text" id="name_v_' + (j - 1) + '" placeholder="Ex:項目分類" value="' + item_name[j] + '" required />';

                        div_item += '<button rm_id="' + (j - 1) + '" id="name_d_' + (j - 1) + '" class="col-md-3 btn btn-danger btn-sm btn-block d_n_submit"  type="button">移除</button>';
                        div_item += "</div>";
                        t_p_row1 += '<th scope="col" style="min-width: 200px;" class="column_' + (j - 1) + '">' + div_item + "</th>";
                    }
                }

                if (size_item > 0) {
                    //t_body
                    //新增按鈕/項目內容
                    //u指定內容 && body
                    var butn2 = "";
                    var t_p_row2 = "";
                    var id = 0;
                    //筆數
                    for (var j = 0; j < item_value.length; j++) {
                        id = item_value[j][2];
                        if (j == 0) {
                            //添加筆數
                            id = 1;
                            butn2 = '<button id="' + id + '" class="btn btn-success btn-sm btn-block a_v_submit"  type="button">添加內容</button>';
                            t_p_row2 = '<tr class= "t_p_row' + id + '"><td ><b>內容</b></td>';
                            t_p_row2 += '<td class="s_type_btn">' + butn2 + "</td>";
                            t_p_row2 += '<td class="column_1" id="value_id_' + id + '" >' + (item_value[item_value.length - 1][2] + 1) + "</td>";
                            t_p_row2 += '<td class="column_2"><input id="value_note_' + id + '" class="col-md-12" type="text" value="" placeholder="Ex:備註內容" /></td>';
                            //欄數
                            for (var k = 4; k < item_value[j].length; k++) {
                                t_p_row2 += '<td class="column_' + (k - 1) + '"><input id="value_' + id + "_" + (k - 1) + '" class="col-md-12" type="text" value=""  placeholder="Ex:內容" /></td>';
                            }
                        } else {
                            //現存筆數
                            butn2 = "<button id=" + id + ' class="btn btn-danger btn-sm btn-block d_v_submit"  type="button">移除內容</button>';
                            t_p_row2 = '<tr class= "t_p_row' + id + '"><td ><b>內容</b></td>';
                            t_p_row2 += '<td class="s_type_btn">' + butn2 + "</td>";
                            t_p_row2 += '<td class="column_1" id="value_id_' + id + '" >' + id + "</td>";
                            t_p_row2 += '<td class="column_2"><input class="col-md-12"  id="value_note_' + id + '" type="text" value="' + item_value[j][3] + '" placeholder="Ex:備註內容"  /></td>';
                            //欄數
                            for (var k = 4; k < item_value[j].length; k++) {
                                t_p_row2 += '<td class="column_' + (k - 1) + '"><input id="value_' + id + "_" + (k - 1) + '" class="col-md-12" type="text" value="' + item_value[j][k] + '"  placeholder="Ex:內容" required /></td>';
                            }
                        }
                        t_p_row2 += "</tr>";
                        $("#item_tbody").append(t_p_row2);
                    }
                    $("#item_lists").show();
                } else {
                    t_p_row1 += '<th id="value_i_v_id" >1</th>';
                    t_p_row1 += '<th ><input id="value_i_v_note" class="col-md-12" type="text"  placeholder="Ex:備註"  /></th>';
                    $("#item_lists").hide();
                }
                //t_header
                $("#item_thead").append(t_p_row1);
				//初始化 行數 與 筆數
                this.now_column_n = $("#item_thead th").length;
                this.now_row_n = $("#item_tbody tr").length+1;
                //添加 欄位項目
                $(document).off("click", "#a_n_submit");
                $(document).on("click", "#a_n_submit", function (event) {
                    templateBody.added_column_one();
                });
                //移除 欄位項目
                $(document).off("click", ".d_n_submit");
                $(document).on("click", ".d_n_submit", function (event) {
                    templateBody.delete_column_one(event);
                });
                //添加 內容項目
                $(document).off("click", ".a_v_submit");
                $(document).on("click", ".a_v_submit", function (event) {
                    templateBody.added_row_one();
                });
                //移除 內容
                $(document).off("click", ".d_v_submit");
                $(document).on("click", ".d_v_submit", function (event) {
                    templateBody.delete_row_one(event);
                });
            },
            //添加欄位數
            added_column_one: function () {
                //取得新增參數
                console.log("row= " + this.now_row_n);
                console.log("column= " + this.now_column_n);
                $("#item_lists").show();
                $("#name_v").val();
                j = this.now_column_n;
                var div_item = "";
                div_item += '<div class ="row ml-0 mr-0">';
                div_item += '<input class="col-md-8  mr-2" type="text" id="name_v_' + (j - 1) + '" placeholder="Ex:項目分類" value="" required/>';

                div_item += '<button rm_id="' + (j - 1) + '" id="name_d_' + (j - 1) + '" class="col-md-3 btn btn-danger btn-sm btn-block d_n_submit"  type="button">移除</button>';
                div_item += "</div>";
                var t_p_row1 = '<th scope="col" style="min-width: 200px;" class="column_' + (j - 1) + '">' + div_item + "</th>";

                //t_header
                $("#item_thead").append(t_p_row1);

                var k = this.now_row_n;
                //t_body
                var t_p_row2 = "";
                for (var i = 0; i < k; i++) {
                    var id = $("#item_tbody .t_p_row" + i + " td button").attr("id");
                    t_p_row2 = '<td class="column_' + (j - 1) + '"><input id="value_' + id + "_" + (j - 1) + '" class="col-md-12" type="text" value=""  placeholder="Ex:內容" required /></td>';
                    $("#item_tbody .t_p_row" + i).append(t_p_row2);
                }
                //移除 欄位項目
                $(document).off("click", ".d_n_submit");
                $(document).on("click", ".d_n_submit", function (event) {
                    templateBody.delete_column_one(event);
                });
                this.now_column_n += 1;
            },
            //移除欄位
            delete_column_one: function (event) {
                console.log(event.target.id);
                var id = $("#" + event.target.id).attr("rm_id");
                $(".column_" + id).remove();
                this.now_column_n--;
            },
            //添加內容數
            added_row_one: function () {
                var id = $('.t_p_row1 .column_1').text();
                this.now_row_n = parseInt(id);//跟ID變化
            	var c = this.now_column_n;
                var r = this.now_row_n;

            	//添加筆數
                var butn2 = "<button id=" + id + ' class="btn btn-danger btn-sm btn-block d_v_submit"  type="button">移除內容</button>';
                var t_p_row2 = '<tr class= "t_p_row' + r + '"><td ><b>內容</b></td>';
                t_p_row2 += '<td class="s_type_btn">' + butn2 + "</td>";
                t_p_row2 += '<td class="column_1" id="value_id_' + id + '" >' + id + "</td>";
                t_p_row2 += '<td class="column_2"><input class="col-md-12"  id="value_note_' + id + '" type="text" value="' +  $('.t_p_row1 .column_2 input').val() + '" placeholder="Ex:備註內容"  required/></td>';
                //欄數
                for (var k = 4; k < c; k++) {
                    t_p_row2 += '<td class="column_' + (k - 1) + '"><input id="value_' + id + "_" + (k - 1) + '" class="col-md-12" type="text" value="' + $('.t_p_row1 .column_'+(k-1)+' input').val() + '"  placeholder="Ex:內容" required /></td>';
                }
                $("#item_tbody").append(t_p_row2);
                //更筆數量
                this.now_row_n +=1;
                $('.t_p_row1 .column_1').text(this.now_row_n);
                //清空
                 $('.t_p_row1 td input').val("");
            },
            //移除資料
            delete_row_one: function (event) {
            	 console.log(event.target.id);
                 var id = event.target.id;
                 this.rm_id.push(id);
                 $(".t_p_row" + id).remove();
            },
            //--------------傳送 新增 or 修改 or 刪除--------------
            send_added_or_update_save: function () {
                var content = new Object();
				var group_list = [];
                content.group_id = $("#a_u_group_id").text();
                content.group_name = $("#a_u_group_name").val();
                content.type_order = $("#a_u_type_order").val();
                content.type = $("#a_u_group_type select").val();
                content.checkdf = $("#a_u_group_checkdf").prop("checked");

                
                var action = "C";
                var url = "./added_bom_type_item.do";
                var order = "search_update"; //指令
                if ($("#a_u_type").text() == "新增資料") {
	                if($("#item_thead th").length >4){
	                	//真正有資料新增群組 
	                	 group_list[0] = $("#value_i_v_id").text();
	                	 group_list[1] = $("#value_i_v_note").val();
	                	 for(var r = 4;r<this.now_column_n;r++){
	                		 group_list[r-2]=$("#item_thead th div input")[r-4].value;
	                	 }
	                	 content.group_list =  group_list;
	                }else{
	                	 return false;//沒輸入完值整資料
	                }
                }
                if ($("#a_u_type").text() == "修改資料") {
                    action = "U";
                    url = "./update_bom_type_item.do";
                    if($("#item_thead th").length >4){
	                	//真正有資 修改 增群組   (id /note)
	                	 group_list[0] = $("#name_v_1").text();
	                	 group_list[1] = $("#name_v_2 input").val();
	                	 for(var r = 4;r<this.now_column_n;r++){
	                		 group_list[r-2]=$("#item_thead th div input")[r-3].value;
	                	 }
	                	 content.group_list =  group_list;
	                	 //真正有資 修改 增內容
	                	 var item_one = [];
	                	 var item_list = [];
	                	 console.log($("#item_tbody tr"));
	                	 var id = 0;
	                	 for(var i = 1;i<$("#item_tbody tr").length;i++){
	                		item_one = [];
	                		id = $("#item_tbody tr .column_1")[i].textContent;//id
	                		item_one.push(id);
                			for(var j=0;j<$(".t_p_row"+id+" td input").length;j++){
                				item_one.push($(".t_p_row"+id+" td input")[j].value);
                			}
                			item_list.push(item_one);
	                	 }
	                	 content.item_list = item_list;

                    }else{
                    	 return false;//沒輸入完值整資料
                    }
                }
                if ($("#a_u_type").text() == "移除資料") {
                    action = "D";
                    url = "./delete_bom_type_item.do";
                }

                var data = JSON.stringify({
                    data: {
                        datetime: "",
                        action: action,
                        whoami: main.loginData.account,
                        cellBackName: "bodyAfter",
                        cellBackOrder: order,
                        content: content,
                    },
                });
                main.ajaxSend(url, data);
                return false; //防止真傳送
            },
            //傳送 查詢
            send_search: function () {
                var content = new Object();
                content.group_name = $("#s_group_name").val();

                var url = "./bom_type_item.do";
                var order = "search_update"; //指令

                var data = JSON.stringify({
                    data: {
                        datetime: "",
                        action: "R",
                        whoami: main.loginData.account,
                        cellBackName: "bodyAfter",
                        cellBackOrder: order,
                        content: content,
                    },
                });
                main.ajaxSend(url, data);
            },
            //Rsp-回傳值-指令
            bodyAfter: function (event) {
                console.log("to index success");
                switch (event.r_cellBackOrder) {
                    case "search_update":
                        //刷新資料
                        if (event.r_content.templateInfo.body["list"] != null && event.r_content.templateInfo.body["list"] != "") {
                            this.search_list = main.contentData.templateInfo.body["list"]["group_list"];
                            this.search_item = main.contentData.templateInfo.body["list"]["item_list"];
                            this.search_update();
                            this.rm_added();
                        }
                        break;
                    case "update_body_nav":
                        break;
                }
            },
          //頁數-初始化(新增 or 修改 or 刪除 or 條件 要重製)
			change_page_init : function() {
				//active 更換為第一格
				var a = "active";
				var d = "disabled";
				$(".page-item").removeClass(a);
				$(".page-item").removeClass(d);
				for (var re_page = 1; re_page <= 10; re_page++) {
					var now_page = re_page + (this.page_batch * 10);
					//如果就在第一頁 不需更換
					if (!$(".p" + now_page).hasClass("p" + re_page)) {
						$(".p" + now_page).addClass("p" + re_page);
						$(".p" + re_page).removeClass("p" + now_page);
						$(".p" + re_page + " a").text(re_page);
						$(".p" + re_page + " a").attr("id",
								"p" + re_page);
					}
					if (re_page == 1) {
						$(".p" + now_page).addClass(a);
					}
				}
				//分頁功能
				this.page_max = 100;//當前本批 筆數
				this.page_max_total = 100;//最大總數
				this.page_batch = 0;//第幾批
				this.page_batch_total = 100;//每批間格值
				this.page_every = 10;//當前每頁筆數
				this.page_stay = 1;//當前頁數

			},
			//頁數-刷新
			change_page_update : function() {
				//頁數-取得當前最大筆數 && 頁數
				this.page_max = this.search_list.length;
				$(".p_n").removeClass("disabled");
				if (this.page_max < this.page_max_total) {
					$(".p_n").addClass("disabled");
				}
				$(".p_p").removeClass("disabled");
				if (this.page_batch < 1) {
					$(".p_p").addClass("disabled");
				}
				//頁數-隱藏多於頁數
				$(".p_nb").addClass("disabled");

			},
			//頁數-換頁按鈕建置(頁數-每頁顯示)
			change_page_btn : function(i) {
				var d_none = "";
				if (i > (this.page_every * this.page_stay)) {
					d_none = "d-none";
				}
				//頁數-(個位數)+(十位數)
				var page_group = "pg_"
						+ (Math.floor((i - 1) / this.page_every) + 1 + (this.page_batch * 10));
				var page_nb = "p"
						+ (Math.floor((i - 1) / this.page_every) + 1 + (this.page_batch * 10));
				$("." + page_nb).removeClass("disabled");
				return page_group + " " + d_none;
			},
			//頁數-換頁查詢
			change_page : function(event) {
				var d = "disabled";
				var d_n = "d-none";
				var a = "active";
				var pg = "pg_";
				console.log("page btn is:" + event.text);
				//選定頁數
				if (event.id != "p_p" && event.id != "p_n") {
					$(".page-item").removeClass(a);
					$("." + event.id).addClass(a);

					$(".page_all").addClass(d_n);
					$("." + pg + event.text).removeClass(d_n);

				} else if (event.id == "p_p") {//上10頁(批數 要大於1)
					if (this.page_batch > 0) {
						//換上一批次 頁數
						$(".page-item").removeClass(a);

						for (var i = 1; i <= 10; i++) {
							var now_page = i + (this.page_batch * 10);
							var previous_page = i
									+ ((this.page_batch) * 10) - 10;
							$(".p" + now_page).addClass(
									"p" + previous_page);
							$(".p" + previous_page).removeClass(
									"p" + now_page);
							$(".p" + previous_page + " a").text(
									previous_page);
							$(".p" + previous_page + " a").attr("id",
									"p" + previous_page);
							if (i == 1) {
								$(".p" + previous_page).addClass(a);
							}
						}
						this.page_batch -= 1;
						this.send_search("");
					}
				} else if (event.id == "p_n") {//下10頁(必須滿100筆最大量 )
					if (this.page_max >= this.page_max_total) {
						//換下一批次 頁數
						$(".page-item").removeClass(a);
						for (var i = 1; i <= 10; i++) {
							var now_page = i + (this.page_batch * 10);
							var next_page = i
									+ ((this.page_batch + 1) * 10);
							$(".p" + now_page)
									.addClass("p" + next_page);
							$(".p" + next_page).removeClass(
									"p" + now_page);
							$(".p" + next_page + " a").text(next_page);
							$(".p" + next_page + " a").attr("id",
									"p" + next_page);
							if (i == 1) {
								$(".p" + next_page).addClass(a);
							}
						}
						this.page_batch += 1;
						this.send_search("");
					}
				}
				return false;
			},
        },
        //移除監聽事件
        beforeDestroy: function () {
            console.log("to beforeDestroy event");
            $(document).off("click", ".a_submit");
            $(document).off("click", ".d_submit");
            $(document).off("click", ".d_v_submit");
            $(document).off("click", ".d_n_submit");
            $(document).off("click", ".a_v_submit");

            $(document).off("click", "#search_choose input");
            $(document).off("click", "#s_submit");
            $(document).off("click", "#a_c_submit");
        },
    });
</script>
