<div class="row border" id="sys_group_body">
	<div class="col-md-12 border">
		<!-- 功能: 查詢 /新增 /修改 -->
		<div class="mt-3 mb-3 border">
			<div class="mb-3">
				<h3>
					<b>群組功能</b>
				</h3>
			</div>
			<!-- 查詢功能 -->
			<div class="mb-3 border border-primary shadow bg-light">
				<div class="row mb-2">
					<div class="col-md-5">
						<a class="btn btn-sm btn-success" data-toggle="collapse" href="#collapseSearch" role="button" aria-expanded="true" aria-controls="collapseSearch"> 查詢功能 : </a>
					</div>
				</div>
				<div class="mb-3 collapse show" id="collapseSearch">
					<div class="row mb-5">
						<div class="col-md-4">
							<div class="row">
								<div class="col-md-12 text-left">
									群組名稱 : <input class="col-md-7" type="text" id="s_name" name="s_name" placeholder="Ex:功能設定" required autofocus />
								</div>
							</div>
						</div>
					</div>
					<div class="row mb-2">
						<div class="col-md-5"></div>
						<div class="col-md-2">
							<button id="s_submit" class="col-md-12 btn btn-primary btn-block" type="submit">查詢</button>
						</div>
						<div class="col-md-5"></div>
					</div>
				</div>
			</div>
			<!-- 功能:查詢結果  /修改 -->
			<div class="mb-3 border border-primary shadow bg-light">
				<div class="border">
					<div class="row mb-2">
						<div class="col-md-5">
							<a class="btn btn-sm btn-success" data-toggle="collapse" href="#collapseFinish" role="button" aria-expanded="true" aria-controls="collapseFinish"> 查詢結果 : </a>
						</div>
					</div>
					<div class="collapse show" id="collapseFinish">
						<div class="col-md-12">
							<div id="search_choose" class="row mb-2">
								<div class="text-left">
									<b>顯示名稱-></b>
								</div>
							</div>
							<!-- 顯示內容 -->
							<div class="row">
								<table style="min-height: 480px;" class="table table-sm table-hover table-striped table-bordered table-responsive">
									<thead>
										<tr id="search_thead" class="bg-primary">
											<th scope="col" style="min-width: 90px;">功能</th>
											<th scope="col" style="min-width: 30px;">筆</th>
										</tr>
									</thead>
									<tbody id="search_tbody"></tbody>
								</table>
							</div>
							<div aria-label="Page" id="page-group">
								<ul class="pagination justify-content-center">
									<li class="page-item p_p disabled"><a id="p_p" class="page-link" href="#" onclick="return templateBody.change_page(this);">Previous 10 </a></li>
									<li class="page-item p_nb p1 active"><a id="p1" class="page-link" href="#" onclick="return templateBody.change_page(this);">1</a></li>
									<li class="page-item p_nb p2"><a id="p2" class="page-link" href="#" onclick="return templateBody.change_page(this);">2</a></li>
									<li class="page-item p_nb p3"><a id="p3" class="page-link" href="#" onclick="return templateBody.change_page(this);">3</a></li>
									<li class="page-item p_nb p4"><a id="p4" class="page-link" href="#" onclick="return templateBody.change_page(this);">4</a></li>
									<li class="page-item p_nb p5"><a id="p5" class="page-link" href="#" onclick="return templateBody.change_page(this);">5</a></li>
									<li class="page-item p_nb p6"><a id="p6" class="page-link" href="#" onclick="return templateBody.change_page(this);">6</a></li>
									<li class="page-item p_nb p7"><a id="p7" class="page-link" href="#" onclick="return templateBody.change_page(this);">7</a></li>
									<li class="page-item p_nb p8"><a id="p8" class="page-link" href="#" onclick="return templateBody.change_page(this);">8</a></li>
									<li class="page-item p_nb p9"><a id="p9" class="page-link" href="#" onclick="return templateBody.change_page(this);">9</a></li>
									<li class="page-item p_nb p10"><a id="p10" class="page-link" href="#" onclick="return templateBody.change_page(this);">10</a></li>
									<li class="page-item p_n disabled"><a id="p_n" class="page-link" href="#" onclick="return templateBody.change_page(this);">Next 10 </a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 新增/修改功能 -->
			<div class="border border-primary shadow bg-light">
				<div class="row mb-2">
					<div class="col-md-5">
						<a class="btn btn-sm btn-success" data-toggle="collapse" href="#collapseAdded" role="button" aria-expanded="true" aria-controls="collapseAdded"> 新增/修改/刪除 功能 : </a>
					</div>
				</div>
				<form onsubmit="return templateBody.send_added_or_update_save();">
					<div class="collapse show" id="collapseAdded">
						<!-- 新增 或 修改(分辨) -->
						<div class="row mb-2">
							<div class="col-md-3">
								<div class="row">
									<div class="col-md-12 text-left">
										<div class="col-md-12">狀態 :</div>
										<div class="col-md-12" id="a_u_type" style="font-size: 25px; color: red;">新增資料</div>
									</div>
								</div>
							</div>
							<div class="col-md-3">
								<div class="row">
									<div class="col-md-12 row text-left">
										<div class="col-md-11">使用者群組ID :</div>
										<div class="" id="a_u_id">0</div>
									</div>
								</div>
							</div>
						</div>
						<div class="dropdown-divider" style="border-top: 1px solid green;"></div>
						<!-- 新增 或 修改 或 刪除(內容) -->
						<div class="row mb-3 mt-3">
							<div class="col-md-3">
								<div class="row">
									<div class="col-md-12 text-left">
										使用者群組 : <input class="col-md-6" type="text" id="a_name" name="a_name" placeholder="Ex:帳號設定" required />
									</div>
								</div>
							</div>
							<div class="col-md-3">
								<div class="row">
									<div class="col-md-12 text-left">
										是否啟用 : <input class="col-md-7" type="text" id="a_useful" name="a_useful" placeholder="1=開 2=關" required />
									</div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="row">
									<div class="col-md-12 text-left">
										說明備註 : <input class="col-md-8" type="text" id="a_note" name="a_note" placeholder="Ex:可不寫" required />
									</div>
								</div>
							</div>
						</div>
						<!-- 顯示權限 內容 -->
						<div class="col-md-12">
							<div class="row">
								<table class="table table-sm table-hover table-striped table-bordered table-responsive">
									<thead>
										<tr id="permission_thead" class="bg-primary">
											<th scope="col" style="min-width: 80px;">功能</th>
											<th scope="col" style="min-width: 40px;">筆</th>
										</tr>
									</thead>
									<tbody id="permission_tbody"></tbody>
								</table>
							</div>
						</div>
						<div class="row mb-3">
							<div class="col-md-4"></div>
							<div class="col-md-2">
								<div class="">
									<button id="a_u_submit" class="btn btn-primary btn-block" type="submit">存入資料</button>
								</div>
							</div>
							<div class="col-md-2">
								<div class="">
									<button id="a_c_submit" class="btn btn-warning btn-block" type="button">清除內容</button>
								</div>
							</div>
							<div class="col-md-4"></div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
    console.log("sys_group_body");
    templateBody = new Vue({
        el: "#sys_group_body",
        data: {
            group_list: "",
            permission_list: "",
            t_p_row_number: 2,
        	//分頁功能
			page_max : 100,//當前本批 筆數
			page_max_total : 100,//最大總數
			page_batch : 0,//第幾批
			page_batch_total : 100,//每批間格值
			page_every : 10,//當前每頁筆數
			page_stay : 1,//當前頁數
        },
        created: function () {
            //初始化
            templateBody = this;
            console.log(main.contentData.templateInfo.body);
            this.group_list = main.contentData.templateInfo.body["group_list"];
            this.permission_list = main.contentData.templateInfo.body["permission_list"];

            //t_choose
            var t_choose = "";
            for (var i = 0; i < this.group_list[0].length; i++) {
                t_choose += '[<div class="text-left form-check">';
                t_choose += '<input class="form-check-input" type="checkbox" value="" id="s_' + i + '" checked>';
                t_choose += '<label class="form-check-label" for="s_' + i + '">';
                t_choose += this.group_list[0][i];
                t_choose += "</label></div>]";
            }
            $("#search_choose").append(t_choose);
            //t_header_group
            var t_header_group = "";
            for (var i = 0; i < this.group_list[0].length; i++) {
            	if(i ==7){
            		 t_header_group += '<th style="min-width: 175px; width: 100%;" class="s_' + i + '" scope="col">' + this.group_list[0][i] + "</th>";
            	}else if(i ==0 || i==2){
                    t_header_group += '<th style="min-width: 175px;" class="s_' + i + '" scope="col">' + this.group_list[0][i] + "</th>";
            	}else{
                	t_header_group += '<th style="min-width: 85px;" class="s_' + i + '" scope="col">' + this.group_list[0][i] + "</th>";
            	}
            }
            $("#search_thead").append(t_header_group);
            //t_header_permission
            var t_header_p = "";
            t_header_p += '<th style="min-width: 40px;" class="s_p_' + i + '" scope="col">' + this.group_list[1][0] + "</th>";
            for (var i = 1; i < 5; i++) {
                t_header_p += '<th style="min-width: 90px;" class="s_p_' + i + '" scope="col">' + this.group_list[1][i] + "</th>";
            }
            for (var i = 5; i < this.group_list[1].length; i++) {
                t_header_p += '<th style="min-width: 80px;" class="s_p_' + i + '" scope="col">' + this.group_list[1][i] + "</th>";
            }
            $("#permission_thead").append(t_header_p);
            //t_body_permission
            this.added_permission();
            //t_body_group
            this.search_update();

            //動態監聽顯示Table 物件 查看開關
            $(document).on("click", "#search_choose input", function (event) {
                templateBody.search_choose(event);
            });
            //查詢監聽
            $(document).on("click", "#s_submit", function (event) {
                templateBody.send_search();
            });
            //清除修改
            $(document).on("click", "#a_c_submit", function (event) {
                templateBody.rm_added();
            });
        },
        methods: {
            //動態切換 動態更改單元組
            change_permission: function (event) {
                $.each(templateBody.permission_list, function (key, value) {
                    if (value[0] == event.target.value) {
                        $("#a_0").text(value[0]);
                        $("#a_2").text(value[2]);
                        $("#a_3").text(value[3]);
                    }
                });
            },
            //新增 權限列表
            added_permission: function () {
                //t_body
                //新增按鈕
                var butn = '<button permission_id="2" class="btn btn-success btn-sm btn-block a_p_submit"  type="button">添加</button>';
                var t_p_row2 = '<tr class= "t_p_row2"><th class="s_type_added">' + butn + "</th>";
                //筆數
                t_p_row2 += "<td >0</td>";
                t_p_row2 += '<td class="s_0" id=a_0>0</td>';
                //選項-單元/ID
                var p_option = '<option id="per_x" value="">請選擇</option>';
                for (var i = 0; i < this.permission_list.length; i++) {
                    p_option = p_option + '<option id="per_'+this.permission_list[i][0]+'" value="' + this.permission_list[i][0] + '">' + this.permission_list[i][1] + "</option>";
                }
                t_p_row2 += '<td class=s_1><select class="md-12 a_row2" id="a_1" name="a_1" >' + p_option + "</select></td>";
                //控制單元
                t_p_row2 += "<td class=s_2 id=a_2>" + this.permission_list[0][2] + "</td>";
                //單元群組
                t_p_row2 += "<td class=s_3 id=a_3>" + this.permission_list[0][3] + "</td>";
                //權限
                for (var j = 4; j < this.group_list[1].length; j++) {
                    t_p_row2 += '<td class="s_' + j + '">';
                    t_p_row2 += '<input class="col-md-12 a_row2" type="checkbox" id="a_' + j + '" name="a_' + j + ' "style="height: 25px;">';
                    t_p_row2 += "</td>";
                }
                t_p_row2 += "</tr>";
                $("#permission_tbody").append(t_p_row2);

                //建立切換 單元->動態更改單元組 監聽事件
                $(document).on("change", "#a_1", function (event) {
                    templateBody.change_permission(event);
                });
                //添加 權限 監聽
                $(document).off("click", ".a_p_submit");
                $(document).on("click", ".a_p_submit", function (event) {
                    templateBody.added_permission_one();
                });
            },

            //查詢更新
            search_update: function () {
            	//頁數-刷新
				this.change_page_update();
                $("#search_tbody").empty();
                //t_body
                var t_body = "";
                var g_list = "";
                var a_submit = "";
                var d_submit = "";
                for (var i = 2; i < this.group_list.length; i++) {
                	//頁數-每頁顯示(不再顯示範圍內則隱藏)
					var page_group = this.change_page_btn(i);
                    //功能
                    g_list = this.group_list[i]["group"][4];

                    a_submit = "";
                    a_submit += '<div class="md-6">';
                    a_submit += '<button permission_id="' + g_list + '" class="btn btn-warning btn-sm btn-block a_submit">';
                    a_submit += "改</button></div>";

                    d_submit = "";
                    d_submit += '<div class="md-6 ml-1">';
                    d_submit += '<button permission_id="' + g_list + '" class="btn btn-danger btn-sm btn-block d_submit">';
                    d_submit += "刪</button></div>";

                    t_body += '<tr class="page_all t_row' + g_list + ' '+page_group+'" ><th class="ml-0 col-md-12 row">' + a_submit + d_submit + "</th>";
                    //計數量
                    t_body += "<td>" + (i - 1) + "</td>";
                    //權限內容
                    for (var j = 0; j < this.group_list[i]["group"].length; j++) {
                        t_body += "<td class=s_" + j + ">" + this.group_list[i]["group"][j] + "</td>";
                    }
                }
                $("#search_tbody").append(t_body + "</tr>");

                //修改監聽
                $(document).on("click", ".a_submit", function (event) {
                    templateBody.choose_update("修改資料", event);
                });
                //刪除監聽
                $(document).on("click", ".d_submit", function (event) {
                    templateBody.choose_delete(event);
                });
            },
            //顯示 查詢列表
            search_choose: function (event) {
                console.log(event.target.checked);
                if (!event.target.checked) {
                    $("#search_thead ." + event.target.id).hide();
                    $("#search_tbody ." + event.target.id).hide();
                } else {
                    $("#search_thead ." + event.target.id).show();
                    $("#search_tbody ." + event.target.id).show();
                }
            },
            //清除新增/修該內容
            rm_added: function () {
                $("#a_u_type").text("新增資料");
                $("#a_u_id").text("0");
                $("#a_u_group").text("");

                $("#a_name").val("");
                $("#a_useful").val("");
                $("#a_note").val("");
                $("#permission_tbody").empty();
                this.added_permission();
                this.choose_disabled(false);
            },

            //選擇  修改群組
            choose_update: function (type, event) {
                var id = event.target.attributes.permission_id.value;
                $("#permission_tbody").empty();

                $("#a_name").val($(".t_row" + id + " .s_5")[0].innerText);
                $("#a_note").val($(".t_row" + id + " .s_7")[0].innerText);
                $("#a_useful").val($(".t_row" + id + " .s_6")[0].innerText);

                $("#a_u_id").text($(".t_row" + id + " .s_4")[0].innerText);
                $("#a_u_type").text(type);

                this.added_permission();
                //搜尋群組 ID
                var lock_target = "";
                for (var l = 2; l < this.group_list.length; l++) {
                    if (this.group_list[l]["group"][4] == id) {
                        lock_target = this.group_list[l]["permission"];
                        break;
                    }
                }
                
                //t_body
                var k = 2;
                $("#a_1 option").removeClass("d-none");
                for (var i = 0; i < lock_target.length; i++) {
                	//檢查 新添加 a_1 單元是否重複(d-none)排除
                	$("#a_1 #per_"+lock_target[i][0]).addClass("d-none");
                    //功能
                    var p_list = lock_target[i][0] + k;

                    var p_t_list = '<tr class="t_p_row' + p_list + ' "><th class="s_type_delete">';
                    p_t_list += '<button permission_id="' + p_list + '" class="btn btn-danger btn-sm btn-block d_p_submit" type="button">刪除</button>';
                    p_t_list += "</th></tr>";
                    $("#permission_tbody").append(p_t_list);

                    //計數量
                    $("#permission_tbody .t_p_row" + p_list).append("<td >" + (i + 1) + "</td>");
                    //權限內容
                    for (var j = 0; j < lock_target[i].length; j++) {
                        var check = "";
                        if (lock_target[i][j] == 1) {
                            check = "checked";
                        }
                        var p_list_content = "<td class=s_" + j + ">";
                        //前4筆資料是 ID & 名稱 & 控制(隱藏) & 單元組
                        if (j > 3) {
                            p_list_content += '<input class="col-md-12 a_row'+p_list+' a_u_' + j + '" type="checkbox" style="height: 25px;"' + check + ">";
                        } else {
                            p_list_content += lock_target[i][j];
                        }
                        p_list_content += "</td>";

                        $("#permission_tbody .t_p_row" + p_list).append(p_list_content);
                    }
                    //存入最大ID
                    this.t_p_row_number = p_list;
                }

                //刪除 權限 監聽
                $(document).off("click",".d_p_submit");
                $(document).on("click", ".d_p_submit", function (event) {
                	 templateBody.rm_permission(event);
                });
                this.choose_disabled(false);
            },
            //暫時 添加一筆權限 資料
            added_permission_one: function () {
            	//防止沒選
            	if($(".t_p_row2 .s_1 select").val()==""){
            		return;
            	}
                this.t_p_row_number += 1;
                //功能
                var p_t_list = '<tr class="t_p_row' + this.t_p_row_number + ' "><th class="s_type_delete">';
                p_t_list += '<button permission_id="' + this.t_p_row_number + '" class="btn btn-danger btn-sm btn-block d_p_submit" type="button">刪除</button>';
                p_t_list += "</th></tr>";
                $("#permission_tbody").append(p_t_list);
                //計數量
                $("#permission_tbody .t_p_row" + this.t_p_row_number).append("<td>N</td>");

                // 單元ID-單元名稱-權限
                var p_list_content = "<td class=s_0>" + $(".t_p_row2 .s_1 select").val() + "</td>";
                p_list_content += "<td class=s_1>" + $(".t_p_row2 .s_1 select option:selected").text() + "</td>";
                p_list_content += "<td class=s_2>" + $(".t_p_row2 .s_2").text() + "</td>";
                p_list_content += "<td class=s_3>" + $(".t_p_row2 .s_3").text() + "</td>";
                $("#permission_tbody .t_p_row" + this.t_p_row_number).append(p_list_content);

                //資料是 ID 與 名稱 控制 群組名稱
                p_list_content = "";
                for (var i = 4; i <= 11; i++) {
                    var check = "";
                    if ($(".t_p_row2 .s_" + i + " input")[0].checked) {
                        check = "checked";
                    }
                    p_list_content += "<td class=s_" + i + ">";
                    p_list_content += '<input class="col-md-12 a_row'+this.t_p_row_number+' a_u_' + i + '" type="checkbox" style="height: 25px;" ' + check + ">";
                    p_list_content += "</td>";
                }
                $("#permission_tbody .t_p_row" + this.t_p_row_number).append(p_list_content);
                
                //刪除 權限 監聽
                $(document).off("click",".d_p_submit");
                $(document).on("click", ".d_p_submit", function (event) {
                    templateBody.rm_permission(event);
                });
                
                //檢查重複
                $(".t_p_row2 .s_1 select").val('').trigger('change');
                $("#a_1 option").removeClass("d-none");
                var lock_target = $('#permission_tbody tr .s_0');
                for (var i = 0; i < lock_target.length; i++) {
                	//檢查 新添加 a_1 單元是否重複(d-none)排除
                	$("#a_1 #per_"+lock_target[i].textContent).addClass("d-none");
                }
            },
            //移除權限
            rm_permission: function (event) {
                var id = event.target.attributes.permission_id.value;
                if($(".t_p_row"+id+" .a_row"+id).attr("disabled")=="disabled"){
                	$(".t_p_row"+id+" .a_row"+id).attr("disabled", false);
                }else{
                   	$(".t_p_row"+id+" .a_row"+id).attr("disabled", "disabled");
                }
            },
            //選擇 刪除
            choose_delete: function (event) {
                var id = event.target.attributes.permission_id.value;
                $("#a_u_type").text("移除資料");
                $("#a_u_id").text($(".t_row" + id + " .s_4")[0].innerText);
                $("#a_u_group").text($(".t_row" + id + " .s_6")[0].innerText);

                this.choose_update("移除資料", event);
                this.choose_disabled("disabled");
            },
            //鎖定資料
            choose_disabled: function (disabled) {
                $("#a_name").attr("disabled", disabled);
                $("#a_note").attr("disabled", disabled);
                $("#a_useful").attr("disabled", disabled);
                $(".d_p_submit").attr("disabled", disabled);
                $(".a_p_submit").attr("disabled", disabled);

                //鎖定新增清單
                $("#permission_tbody select").attr("disabled", disabled);
                $("#permission_tbody input").attr("disabled", disabled);
            },
            //頁數-初始化(新增 or 修改 or 刪除 or 條件 要重製)
			change_page_init : function() {
				//active 更換為第一格
				var a = "active";
				var d = "disabled";
				$(".page-item").removeClass(a);
				$(".page-item").removeClass(d);
				for (var re_page = 1; re_page <= 10; re_page++) {
					var now_page = re_page + (this.page_batch * 10);
					//如果就在第一頁 不需更換
					if (!$(".p" + now_page).hasClass("p" + re_page)) {
						$(".p" + now_page).addClass("p" + re_page);
						$(".p" + re_page).removeClass("p" + now_page);
						$(".p" + re_page + " a").text(re_page);
						$(".p" + re_page + " a").attr("id",
								"p" + re_page);
					}
					if (re_page == 1) {
						$(".p" + now_page).addClass(a);
					}
				}
				//分頁功能
				this.page_max = 100;//當前本批 筆數
				this.page_max_total = 100;//最大總數
				this.page_batch = 0;//第幾批
				this.page_batch_total = 100;//每批間格值
				this.page_every = 10;//當前每頁筆數
				this.page_stay = 1;//當前頁數

			},
			//頁數-刷新
			change_page_update : function() {
				//頁數-取得當前最大筆數 && 頁數
				this.page_max = this.group_list.length;
				$(".p_n").removeClass("disabled");
				if (this.page_max < this.page_max_total) {
					$(".p_n").addClass("disabled");
				}
				$(".p_p").removeClass("disabled");
				if (this.page_batch < 1) {
					$(".p_p").addClass("disabled");
				}
				//頁數-隱藏多於頁數
				$(".p_nb").addClass("disabled");

			},
			//頁數-換頁按鈕建置(頁數-每頁顯示)
			change_page_btn : function(i) {
				var d_none = "";
				if (i > (this.page_every * this.page_stay)) {
					d_none = "d-none";
				}
				//頁數-(個位數)+(十位數)
				var page_group = "pg_"
						+ (Math.floor((i - 1) / this.page_every) + 1 + (this.page_batch * 10));
				var page_nb = "p"
						+ (Math.floor((i - 1) / this.page_every) + 1 + (this.page_batch * 10));
				$("." + page_nb).removeClass("disabled");
				return page_group + " " + d_none;
			},
			//頁數-換頁查詢
			change_page : function(event) {
				var d = "disabled";
				var d_n = "d-none";
				var a = "active";
				var pg = "pg_";
				console.log("page btn is:" + event.text);
				//選定頁數
				if (event.id != "p_p" && event.id != "p_n") {
					$(".page-item").removeClass(a);
					$("." + event.id).addClass(a);

					$(".page_all").addClass(d_n);
					$("." + pg + event.text).removeClass(d_n);

				} else if (event.id == "p_p") {//上10頁(批數 要大於1)
					if (this.page_batch > 0) {
						//換上一批次 頁數
						$(".page-item").removeClass(a);

						for (var i = 1; i <= 10; i++) {
							var now_page = i + (this.page_batch * 10);
							var previous_page = i
									+ ((this.page_batch) * 10) - 10;
							$(".p" + now_page).addClass(
									"p" + previous_page);
							$(".p" + previous_page).removeClass(
									"p" + now_page);
							$(".p" + previous_page + " a").text(
									previous_page);
							$(".p" + previous_page + " a").attr("id",
									"p" + previous_page);
							if (i == 1) {
								$(".p" + previous_page).addClass(a);
							}
						}
						this.page_batch -= 1;
						this.send_search("");
					}
				} else if (event.id == "p_n") {//下10頁(必須滿100筆最大量 )
					if (this.page_max >= this.page_max_total) {
						//換下一批次 頁數
						$(".page-item").removeClass(a);
						for (var i = 1; i <= 10; i++) {
							var now_page = i + (this.page_batch * 10);
							var next_page = i
									+ ((this.page_batch + 1) * 10);
							$(".p" + now_page)
									.addClass("p" + next_page);
							$(".p" + next_page).removeClass(
									"p" + now_page);
							$(".p" + next_page + " a").text(next_page);
							$(".p" + next_page + " a").attr("id",
									"p" + next_page);
							if (i == 1) {
								$(".p" + next_page).addClass(a);
							}
						}
						this.page_batch += 1;
						this.send_search("");
					}
				}
				return false;
			},
            //傳送 新增 or 修改 or 刪除
            send_added_or_update_save: function () {
                var content = [];
                var permission_id =[""];//避免重複
                var permission_one = [];
                var p_tbody = $("#permission_tbody tr");
                var p_12 = 12; //權限順序

                for (var i = 1; i < p_tbody.length; i++) {
                    // 單元 單元組 單元名稱
                    permission_one = new Object();
                    permission_one.id = $("#a_u_id").text();
                    permission_one.name = $("#a_name").val();
                    permission_one.note = $("#a_note").val();
                    permission_one.useful = $("#a_useful").val();
                    permission_one.permission_id = p_tbody[i].children[2].textContent;
                    permission_one.permission_name = p_tbody[i].children[3].textContent;
                    permission_one.permission_control = p_tbody[i].children[4].textContent;
                    permission_one.permission_group = p_tbody[i].children[5].textContent;
                   
                    // 權限
                    permission_one.permission = "";
                    for (var j = 6; j < p_tbody[i].children.length; j++) {
                        if (p_tbody[i].children[j].children[0].checked) {
                            permission_one.permission += "1";
                        } else {
                            permission_one.permission += "0";
                        }
                    }
                    //檢查是否為 刪除標記
                    if(p_tbody[i].children[6].children[0].disabled){
                    	permission_one.rm_id = true;
                    }else{
                    	permission_one.rm_id = false;
                    }
                   
                    permission_one.nbdesc = 1;
                    //建立排序
                    for (var t = 0; t < this.permission_list.length; t++) {
                    	if(this.permission_list[t][0]==permission_one.permission_id){
                    		  permission_one.nbdesc = this.permission_list[t][p_12];
                    		  break;
                    	}
					}
	                content[i-1] = permission_one;
                }
                console.log(content);

                var action = "C";
                var url = "./added_sys_group.do";
                var order = "search_update"; //指令
                if ($("#a_u_type").text() == "修改資料") {
                    action = "U";
                    url = "./update_sys_group.do";
                }
                if ($("#a_u_type").text() == "移除資料") {
                    action = "D";
                    url = "./delete_sys_group.do";
                }

                var data = JSON.stringify({
                    data: {
                        datetime: "",
                        action: action,
                        whoami: main.loginData.account,
                        cellBackName: "bodyAfter",
                        cellBackOrder: order,
                        content: content,
                    },
                });
                main.ajaxSend(url, data);
                return false; //防止真傳送
            },
            //傳送 查詢
            send_search: function () {
                var content = new Object();
                content.name = $("#s_name").val();

                var url = "./sys_group.do";
                var order = "search_update"; //指令

                var data = JSON.stringify({
                    data: {
                        datetime: "",
                        action: "R",
                        whoami: main.loginData.account,
                        cellBackName: "bodyAfter",
                        cellBackOrder: order,
                        content: content,
                    },
                });
                main.ajaxSend(url, data);
            },
            //Rsp-回傳值
            bodyAfter: function (event) {
                console.log("to index success");
                switch (
                    event.r_cellBackOrder //指令
                ) {
                    case "search_update":
                        //空直免刷新
                        if(event.r_content.templateInfo.body["group_list"] !=null && event.r_content.templateInfo.body["group_list"]!="" ){
	                        //刷新資料
	                       this.group_list = event.r_content.templateInfo.body["group_list"];
	                       this.search_update();
	                       this.rm_added();
                        }
                        break;
                    case "update_body_nav":
                        break;
                }
            },
        },
        //監聽事件移除
        beforeDestroy: function () {
            console.log("to beforeDestroy event");

            $(document).off("click", "#search_choose input");
            $(document).off("click", "#s_submit");
            $(document).off("click", "#a_c_submit");
            $(document).off("click", ".a_p_submit");
            $(document).off("click", ".a_submit");
            $(document).off("click", ".d_submit");
            $(document).off("click", ".d_p_submit");
            
            $(document).off("change", "#a_1");
        },
    });
</script>
