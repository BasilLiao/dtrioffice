<script src="./thirdparty/js/jquery-barcode.min.js"></script>
<style id="table2Style">
    #table2 table {
        position: relative;
        font-size: 2rem;
        font-family: Microsoft JhengHei;
    }
    /*
	#table td th {
		border-width: 1px !important;
		border-style: solid !important;
		border-color: black !important;
		-webkit-print-color-adjust: exact;
	}
	
*/
    #table2 th {
        text-align: center;
    }

    #table2 .topic th {
        height: 85px;
        line-height: 85px;
    }

    #table2 td[colspan="6"] {
        padding: 0;
    }

    #table2 td[colspan="6"] table {
        margin: 0;
    }

    #table2 #barcodeInput,
    #table2 #BOMID,
    #table2 .textN1 {
        font-family: monospace;
        font-weight: bold;
        font-size: 1.8rem;
        text-align: center;
    }

    #table2 #barcodeOutput {
        margin: auto;
    }

    #table2 [contenteditable] {
        font-weight: bold;
    }

    #table2 .textN2,
    .textT2 {
        font-size: 1.2rem;
        line-height: 30px;
        height: 32px;
    }

    #table2 .line2 td,
    #table2 .line2 th {
        font-size: 1.5rem;
    }

    #table2 .itemList {
        width: 50%;
        min-height: 800px;
    }

    #table2 .itemList .item {
        line-height: 25px;
    }

    #table2 .others {
        display: inline-block;
        text-align: left;
        padding: 0 10px;
    }

    #table2 .othersEdit {
        display: inline-block;
        min-height: 66px;
    }

    #table2 .sign th {
        font-size: 1.5rem;
    }

    [contentEditable="true"]:empty:not(:focus):before {
        content: attr(data-text);
    }
</style>
<div class="row border" id="production_print_body">
    <div class="col-md-12 border">
        <!-- 功能: 查詢 /新增 /修改 -->
        <div class="mt-3 mb-3 border">
            <div class="mb-3">
                <h3>
                    <b>預覽 生產流程卡 功能</b>
                </h3>
            </div>
            <div>
                <ul class="nav nav-tabs" id="productionTab" role="tablist">
                    <li class="nav-item border-top border-left border-right border-primary rounded">
                        <a class="nav-link active p-1" id="production-tab" data-toggle="tab" href="#production" role="tab" aria-controls="production" aria-selected="false"><b>[製令生產]</b></a>
                    </li>
                    <li class="nav-item border-top border-left border-right border-primary rounded">
                        <a class="nav-link p-1" id="bom-tab" data-toggle="tab" href="#bom" role="tab" aria-controls="bom" aria-selected="true"><b>[產品規格]</b></a>
                    </li>
                </ul>
            </div>
            <div class="tab-content mb-2" id="productionTabContent">
                <div class="tab-pane fade" id="bom" role="tabpanel" aria-labelledby="bom-tab">
                    <!-- 查詢功能 -->
                    <div class="border border-primary shadow mb-2 bg-light">
                        <div class="row mb-1">
                            <div class="col-md-5 mt-1 ml-1" id="collapse_search_btn">
                                <a class="btn btn-success" data-toggle="collapse" href="#collapseSearch" role="button" aria-expanded="true" aria-controls="collapseSearch"><b>[產品規格]查詢功能</b></a>
                            </div>
                        </div>
                        <div class="collapse show" id="collapseSearch">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-6 border border-primary">
                                        <div class="text-left mb-2 mt-2 row m-0">
                                            <div class="col-3 p-0">項目群組:</div>
                                            <select class="col-3 a_row2" id="s_g_item" name="s_g_item">
                                                <option value="">請選擇</option>
                                            </select>
                                        </div>
                                        <div class="text-left mb-2 mt-2 row m-0">
                                            <div class="col-3 p-0">支項項目:</div>
                                            <select class="col-3 a_row2" id="s_i_item" name="s_i_item">
                                                <option value="">請選擇</option>
                                            </select>
                                        </div>
                                        <div class="text-left mb-2 mt-2 row m-0">
                                            <div class="col-3 p-0">產品型號:</div>
                                            <input class="col-7" type="text" id="s_model" name="s_model" placeholder="Ex:型號123456" required autofocus />
                                        </div>
                                        <div class="text-left mb-2 mt-2 row m-0">
                                            <div class="col-3 p-0">BOM料號:</div>
                                            <input class="col-7" type="text" id="s_bom_number" name="s_bom_number" placeholder="Ex:A513-8745940-123" required autofocus />
                                        </div>
                                        <div class="text-left mb-2 mt-2 row m-0 d-none">
                                            <div class="col-3 p-0">BOM ID:</div>
                                            <input class="col-7" type="text" id="s_bom_id" name="s_bom_id" placeholder="Ex:123" required autofocus />
                                        </div>
                                        <div class="row m-0 p-1 mb-2 mt-2">
                                            <div class="col-md-4">
                                                <button id="s_l_submit" class="col-md-12 btn btn-info btn-block m-1" type="submit">Step1.條件登記</button>
                                            </div>
                                            <div class="col-md-4">
                                                <button id="s_submit" class="col-md-12 btn btn-primary btn-block m-1" type="submit">Step2.查詢條件</button>
                                            </div>
                                            <div class="col-md-4">
                                                <button id="s_c_submit" class="col-md-12 btn btn-warning btn-block m-1" type="button">清除條件</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 border border-primary">
                                        <div class="" id="s_l_list">
                                            <div class="text-left mb-2 mt-2">條件清單:</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 功能:查詢結果  /修改 -->
                    <div class="border border-primary shadow bg-light">
                        <div class="border">
                            <div class="row mb-1">
                                <div class="col-md-5 mt-1 ml-1" id="collapse_list_btn">
                                    <a class="btn btn-success" data-toggle="collapse" href="#collapseFinish" role="button" aria-expanded="true" aria-controls="collapseFinish"><b>[產品規格]查詢結果</b></a>
                                </div>
                            </div>
                            <div class="collapse show" id="collapseFinish">
                                <div class="col-md-12">
                                    <div id="search_choose" class="row mb-2">
                                        <div class="text-left">
                                            <b>顯示名稱->(紅字=試產 / 綠字=可量產 / 白亮底色=已使用過)</b>
                                        </div>
                                    </div>
                                    <!-- 顯示內容 -->
                                    <div class="row">
                                        <table style="min-height: 480px;" class="table table-sm table-hover table-striped table-bordered table-responsive">
                                            <thead>
                                                <tr id="search_thead" class="bg-primary">
                                                    <th scope="col" style="min-width: 80px;">功能</th>
                                                    <th scope="col" style="min-width: 40px;">筆</th>
                                                </tr>
                                            </thead>
                                            <tbody id="search_tbody"></tbody>
                                        </table>
                                    </div>
                                    <div aria-label="Page" id="page-group">
                                        <ul class="pagination justify-content-center">
                                            <li class="page-item p_p disabled"><a id="p_p" class="page-link" href="#" onclick="return templateBody.change_page(this);">Previous 10 </a></li>
                                            <li class="page-item p_nb p1 active"><a id="p1" class="page-link" href="#" onclick="return templateBody.change_page(this);">1</a></li>
                                            <li class="page-item p_nb p2"><a id="p2" class="page-link" href="#" onclick="return templateBody.change_page(this);">2</a></li>
                                            <li class="page-item p_nb p3"><a id="p3" class="page-link" href="#" onclick="return templateBody.change_page(this);">3</a></li>
                                            <li class="page-item p_nb p4"><a id="p4" class="page-link" href="#" onclick="return templateBody.change_page(this);">4</a></li>
                                            <li class="page-item p_nb p5"><a id="p5" class="page-link" href="#" onclick="return templateBody.change_page(this);">5</a></li>
                                            <li class="page-item p_nb p6"><a id="p6" class="page-link" href="#" onclick="return templateBody.change_page(this);">6</a></li>
                                            <li class="page-item p_nb p7"><a id="p7" class="page-link" href="#" onclick="return templateBody.change_page(this);">7</a></li>
                                            <li class="page-item p_nb p8"><a id="p8" class="page-link" href="#" onclick="return templateBody.change_page(this);">8</a></li>
                                            <li class="page-item p_nb p9"><a id="p9" class="page-link" href="#" onclick="return templateBody.change_page(this);">9</a></li>
                                            <li class="page-item p_nb p10"><a id="p10" class="page-link" href="#" onclick="return templateBody.change_page(this);">10</a></li>
                                            <li class="page-item p_n disabled"><a id="p_n" class="page-link" href="#" onclick="return templateBody.change_page(this);">Next 10</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade show active" id="production" role="tabpanel" aria-labelledby="production-tab">
                    <!-- 查詢功能 -->
                    <div class="border border-primary shadow bg-light mb-2">
                        <div class="row mb-1">
                            <div class="col-md-5 mt-1 ml-1" id="collapse_search_btn2">
                                <a class="btn btn-success" data-toggle="collapse" href="#collapseSearch2" role="button" aria-expanded="true" aria-controls="collapseSearch2"><b>[製令生產]查詢功能</b></a>
                            </div>
                        </div>
                        <div class="collapse show" id="collapseSearch2">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="text-left mb-2 mt-2">工單號碼: <input class="col-md-8" type="text" id="s_id" name="s_id" placeholder="Ex:製令單 A512-C8763" required autofocus /></div>
                                    <div class="text-left mb-2 mt-2">產品型號: <input class="col-md-8" type="text" id="s_model2" name="s_model2" placeholder="Ex:型號 301KY" required /></div>
                                    <div class="text-left mb-2 mt-2">BOM料號: <input class="col-md-8" type="text" id="s_bom_number2" name="s_bom_number2" placeholder="Ex:90-301-Y11QJ08" required autofocus /></div>
                                    <div class="text-left mb-2 mt-2">
                                        歷史單據(狀態):
                                        <select class="md-12 a_row2" id="s_history_production" name="s_history_production">
                                            <option value="2">準備生產中</option>
                                            <option value="3">已登記生產</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-2 mt-2 row">
                                    <div class="col-md-4"></div>
                                    <div class="col-md-2">
                                        <button id="s_submit2" class="col-md-12 btn btn-primary btn-block mr-2" type="submit">條件查詢</button>
                                    </div>
                                    <div class="col-md-2">
                                        <button id="s_c_submit2" class="col-md-12 btn btn-warning btn-block" type="button">條件清除</button>
                                    </div>
                                    <div class="col-md-4"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 功能:查詢結果(有效製令單)  /修改 -->
                    <div class="border border-primary shadow bg-light">
                        <div class="border">
                            <div class="row mb-1">
                                <div class="col-md-5 mt-1 ml-1" id="collapse_list_btn2">
                                    <a class="btn btn-success" data-toggle="collapse" href="#collapseFinish2" role="button" aria-expanded="true" aria-controls="collapseFinish2"><b>[製令生產]查詢結果</b></a>
                                </div>
                            </div>
                            <div class="collapse show" id="collapseFinish2">
                                <div class="col-md-12">
                                    <div id="search_choose2" class="row mb-2">
                                        <div class="text-left">
                                            <b>顯示名稱-></b>
                                        </div>
                                    </div>
                                    <!-- 顯示內容 -->
                                    <div class="row">
                                        <table style="min-height: 480px;" class="table table-sm table-hover table-striped table-bordered table-responsive">
                                            <thead>
                                                <tr id="search_thead2" class="bg-primary">
                                                    <th scope="col" style="min-width: 80px;">功能</th>
                                                    <th scope="col" style="min-width: 40px;">筆</th>
                                                </tr>
                                            </thead>
                                            <tbody id="search_tbody2"></tbody>
                                        </table>
                                    </div>
                                    <div aria-label="Page" id="page-group2">
                                        <ul class="pagination justify-content-center">
                                            <li class="page-item p_p2 disabled"><a id="p_p2" class="page-link" href="#" onclick="return templateBody.change_page2(this);">Previous 10 </a></li>
                                            <li class="page-item p_nb2 p2_1 active"><a id="p2_1" class="page-link" href="#" onclick="return templateBody.change_page2(this);">1</a></li>
                                            <li class="page-item p_nb2 p2_2"><a id="p2_2" class="page-link" href="#" onclick="return templateBody.change_page2(this);">2</a></li>
                                            <li class="page-item p_nb2 p2_3"><a id="p2_3" class="page-link" href="#" onclick="return templateBody.change_page2(this);">3</a></li>
                                            <li class="page-item p_nb2 p2_4"><a id="p2_4" class="page-link" href="#" onclick="return templateBody.change_page2(this);">4</a></li>
                                            <li class="page-item p_nb2 p2_5"><a id="p2_5" class="page-link" href="#" onclick="return templateBody.change_page2(this);">5</a></li>
                                            <li class="page-item p_nb2 p2_6"><a id="p2_6" class="page-link" href="#" onclick="return templateBody.change_page2(this);">6</a></li>
                                            <li class="page-item p_nb2 p2_7"><a id="p2_7" class="page-link" href="#" onclick="return templateBody.change_page2(this);">7</a></li>
                                            <li class="page-item p_nb2 p2_8"><a id="p2_8" class="page-link" href="#" onclick="return templateBody.change_page2(this);">8</a></li>
                                            <li class="page-item p_nb2 p2_9"><a id="p2_9" class="page-link" href="#" onclick="return templateBody.change_page2(this);">9</a></li>
                                            <li class="page-item p_nb2 p2_10"><a id="p2_10" class="page-link" href="#" onclick="return templateBody.change_page2(this);">10</a></li>
                                            <li class="page-item p_n2 disabled"><a id="p_n2" class="page-link" href="#" onclick="return templateBody.change_page2(this);">Next 10 </a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- SN 自動生成器 -->
            <div class="border border-primary shadow bg-light mb-2">
                <div class="row mb-2 mt-1">
                    <div class="col-md-6 ml-1" id="collapse_report">
                        <a class="btn btn-success" data-toggle="collapse" href="#collapseAdded3" role="button" aria-expanded="true" aria-controls="collapseAdded3"><b>[產品SN序號]編碼產生器</b></a>
                    </div>
                </div>
                <div class="collapse show p-2" id="collapseAdded3">
                    <div class="col-md-12">
                        <div class="row mb-2">
                            <div class="p-2">範例SN碼 :</div>
                            <div class="p-2" id="p_sn_rule" style="background: white;" contenteditable="false"></div>
                        </div>
                    </div>
                    <div class="col-md-12 border border-primary" style="background: white; height: 100px; overflow-y: scroll;">
                        <div class="row" id="sn_p">
                            <div class="p-1 production_sn d-none" id="g_id">
                                <select class="select_sn p-1 pr-3 m-1">
                                    <option class="option_sn" value="" selected="selected">請選擇</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- MES 設定 -->
            <div class="border border-primary shadow bg-light mb-2">
                <div class="row m-0 mb-2 mt-1 ml-1">
                    <div class="col-md-6 p-0" id="collapse_report">
                        <a class="btn btn-success" data-toggle="collapse" href="#collapseAdded4" role="button" aria-expanded="true" aria-controls="collapseAdded3"><b>[通知MES設定]製令類型 ＆ 客製化SN編碼</b></a>
                    </div>
                </div>
                <div class="collapse show p-0 m-1" id="collapseAdded4">
                    <div class="row m-0">
                        <div class="">
                            <select id="pr_type" class="p-1 pr-3 m-1">
                                <option class="production_t_no" value="" selected="selected">製令單類型</option>
                            </select>
                        </div>
                        <div class="">
                            <select id="pr_w_years" class="p-1 pr-3 m-1">
                                <option class="pr_w_years_no" value="" selected="selected">保固年分</option>
                            </select>
                        </div>
                        <div class="">
                            <select id="ph_wpro_id" class="p-1 pr-3 m-1">
                                <option class="ph_wpro_id_no" value="" selected="selected">工作程序</option>
                            </select>
                        </div>
                    </div>
                    <div class="row m-0 p-0 col-12">
                        <div class="custom-control custom-switch m-2"><input id="sn_customized_ok" class="custom-control-input" type="checkbox" /> <label class="custom-control-label" for="sn_customized_ok">客製化編碼(固定):</label></div>
                        <input type="text" id="ps_sn_burn_fixed" name="ps_sn_burn_fixed" placeholder="Ex:301KYTTS2013" class="col-2 m-1" />
                        <div class="m-2">流水號(浮動):</div>
                        <input type="number" id="ps_sn_burn_nb" name="ps_sn_burn_nb" placeholder="Ex:0000" class="col-1 m-1 p-1" max="9999" min="0000"/>
                        <div class="m-2">Part No(驗證碼):</div>
                        <input type="text" id="ph_p_number" name="ph_p_number" placeholder="Ex:123456" class="col-1 m-1" />
                        <div class="m-2">Product Name(產品號):</div>
                        <input type="text" id="ph_p_name" name="ph_p_name" placeholder="Ex:90-311-T63KA01" class="col-2 m-1" />
                    </div>
                </div>
            </div>
            <!-- 產品流程卡 -->
            <div class="border border-primary shadow bg-light mb-2">
                <div class="row mb-2 mt-1">
                    <div class="col-md-2 ml-1" id="collapse_report">
                        <a class="btn btn-success" data-toggle="collapse" href="#collapseAdded2" role="button" aria-expanded="true" aria-controls="collapseAdded2"><b>[產品流程卡]列印預覽</b></a>
                    </div>
                </div>
                <div class="collapse show container" id="collapseAdded2" style="background: white; min-height: 1570px; min-width: 1110px;">
                    <div id="table2" class="border border-dark">
                        <table class="table table-bordered table-sm mb-0">
                            <thead style="border: 3px solid black;">
                                <tr class="topic">
                                    <th class="p-0" style="width: 11%;"><div class="border border-dark border-right-0 border-left-0">M/B</div></th>
                                    <td class="p-0" style="width: 26%;"><div class="border border-dark border-right-0 border-left-0 p-0" style="height: 87px;"></div></td>
                                    <th class="p-0" style="width: 8%;"><div class="border border-dark border-right-0 border-left-0">LAN</div></th>
                                    <td class="p-0" style="width: 25%;"><div class="border border-dark border-right-0 border-left-0 p-0" style="height: 87px;"></div></td>
                                    <th class="p-0" style="width: 7%;"><div class="border border-dark border-right-0 border-left-0">IMEI</div></th>
                                    <td class="p-0" style="width: 25%;"><div class="border border-dark border-right-0 border-left-0 p-0" style="height: 87px;"></div></td>
                                </tr>
                                <tr class="topic">
                                    <th class="p-0"><div class="border border-dark border-right-0 border-left-0">BAT</div></th>
                                    <td class="p-0"><div class="border border-dark border-right-0 border-left-0 p-0" style="height: 87px;"></div></td>
                                    <th class="p-0"><div class="border border-dark border-right-0 border-left-0">WiFi</div></th>
                                    <td class="p-0"><div class="border border-dark border-right-0 border-left-0 p-0" style="height: 87px;"></div></td>
                                    <th class="p-0"><div class="border border-dark border-right-0 border-left-0">SN</div></th>
                                    <td class="p-0">
                                        <div class="p-0 border border-dark border-right-0 border-left-0" style="height: 87px;">
                                            <div id="barcodeOutputSn" class="ml-3 pt-4 bg-white"></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="font-weight-bold text-center" style="font-size: 26px; border-top: 3px solid black;">
                                    <td class="p-0"><div class="border border-dark p-1">工單號</div></td>
                                    <td class="p-0" colspan="5">
                                        <div class="row ml-0 mr-0 border border-gray">
                                            <div class="col-md-5 border rounded border-dark" contenteditable="true" id="barcodeInput" data-text="填寫(工單號碼)"></div>
                                            <div class="col-md-1 p-1 border border-dark">BOM</div>
                                            <div class="col-md-4 border-left border border-dark" id="BOMID"></div>
                                            <div class="col-md-2 p-1 border border-dark" id="kind2"></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="font-weight-bold text-center" style="font-size: 22px;">
                                    <td class="p-0"><div class="border border-dark p-1">條碼</div></td>
                                    <td colspan="5" class="p-0">
                                        <div class="row ml-0 mr-0">
                                            <div class="col-md-7 border border-dark">
                                                <div class="pt-1" id="barcodeOutput"></div>
                                            </div>
                                            <div class="col-md-1 p-1 border border-dark">客戶</div>
                                            <div class="col-md-4 p-0 pt-1 border border-dark" contenteditable="true" id="client_name" data-text="填寫(客戶名稱/位置)"></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="line2" style="text-align: center; font-weight: bold;">
                                    <td class="p-0"><div class="p- pt-1 border border-dark">訂單SO</div></td>
                                    <td colspan="5" class="p-0">
                                        <div class="row ml-0 mr-0">
                                            <div class="col-md-4 p-0 pt-1 border rounded border-dark coll2" contenteditable="true" id="order_id"></div>
                                            <div class="col-md-1 p-0 pt-1 border border-dark">投線</div>
                                            <div class="col-md-2 p-0 border rounded border-dark" id="datepicker1">
                                                <div class="d-none"></div>
                                                <input class="col-md-12 p-0" type="text" value="" placeholder="填寫(投線日期)" />
                                            </div>

                                            <div class="col-md-1 p-0 pt-1 border border-dark">出貨</div>
                                            <div class="col-md-2 p-0 border rounded border-dark" id="datepicker2">
                                                <div class="d-none"></div>
                                                <input class="col-md-12 p-0" type="text" value="" placeholder="填寫(出貨日期)" />
                                            </div>

                                            <div class="col-md-1 p-0 pt-1 border border-dark">數量</div>
                                            <div class="col-md-1 p-0 pt-1 border border-dark coll2 rounded" contenteditable="true" data-text="" id="p_number"></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="line2">
                                    <th class="p-0"><div class="p-0 pt-1 border border-dark">注意項目</div></th>
                                    <td colspan="5" class="p-0">
                                        <div contenteditable="true" id="note" class="p-0 pt-1 pl-1 coll2 border border-dark rounded" data-text=""></div>
                                    </td>
                                </tr>
                                <tr style="border-top: 3px solid black;">
                                    <td colspan="6">
                                        <table class="table table-sm" style="font-size: 20px; text-align: center;">
                                            <tr>
                                                <th class="p-0" style="width: 10%;"><div class="p-0 border border-dark">項目</div></th>
                                                <th class="p-0" style="width: 11%;"><div class="p-0 border border-dark">版本</div></th>
                                                <th class="p-0" style="width: 11%;"><div class="p-0 border border-dark">ECN</div></th>
                                                <th class="p-0" style="width: 8%;"><div class="p-0 border border-dark">Chk</div></th>
                                                <th class="p-0" style="width: 10%;"><div class="p-0 border border-dark">By</div></th>
                                                <th class="p-0" style="width: 10%;"><div class="p-0 border border-dark">項目</div></th>
                                                <th class="p-0" style="width: 22%;"><div class="p-0 border border-dark">更新版本</div></th>
                                                <th class="p-0" style="width: 8%;"><div class="p-0 border border-dark">Chk</div></th>
                                                <th class="p-0" style="width: 10%;"><div class="p-0 border border-dark">By</div></th>
                                            </tr>

                                            <tr>
                                                <th class="p-0"><div class="p-0 textT2 border border-dark">M/B 版本</div></th>
                                                <td class="p-0">
                                                    <div id="mb_ver" contenteditable="true" class="p-0 textN2 border border-dark rounded" data-text=""></div>
                                                </td>
                                                <td class="p-0">
                                                    <div id="mb_ver_ecn" contenteditable="true" class="p-0 textN2 border border-dark rounded" data-text=""></div>
                                                </td>
                                                <td class="p-0"><div class="p-0 textT2 border border-dark"></div></td>
                                                <td class="p-0" rowspan="3"></td>
                                                <th class="p-0"><div class="p-0 border textT2 border-dark">NVRAM</div></th>
                                                <td class="p-0">
                                                    <div id="nvram" contenteditable="true" class="p-0 textN2 border border-dark rounded" data-text=""></div>
                                                </td>
                                                <td class="p-0"><div class="p-0 textT2 border border-dark"></div></td>
                                                <td class="p-0" rowspan="3"></td>
                                            </tr>

                                            <tr>
                                                <th class="p-0"><div class="p-0 textT2 border border-dark">BIOS</div></th>
                                                <td class="p-0" colspan="2">
                                                    <div id="bios" contenteditable="true" class="p-0 textN2 border border-dark rounded" data-text=""></div>
                                                </td>
                                                <td class="p-0"><div class="p-0 textT2 border border-dark"></div></td>
                                                <th class="p-0"><div class="p-0 textT2 border border-dark">MODEL</div></th>
                                                <td class="p-0">
                                                    <div id="product_model_in" contenteditable="true" class="p-0 textN2 border border-dark rounded" data-text=""></div>
                                                </td>
                                                <td class="p-0"><div class="p-0 textT2 border border-dark"></div></td>
                                            </tr>

                                            <tr>
                                                <th class="p-0"><div class="p-0 textT2 border border-dark">EC</div></th>
                                                <td class="p-0" colspan="2">
                                                    <div id="ec" contenteditable="true" class="p-0 textN2 border border-dark rounded" data-text=""></div>
                                                </td>
                                                <td class="p-0"><div class="p-0 textT2 border border-dark"></div></td>
                                                <th class="p-0"><div class="p-0 textT2 border border-dark">OS</div></th>
                                                <td class="p-0">
                                                    <div id="os" contenteditable="true" class="p-0 textN2 border border-dark rounded" data-text=""></div>
                                                </td>
                                                <td class="p-0"><div class="p-0 textT2 border border-dark"></div></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </thead>
                            <tbody style="border: 3px solid black;">
                                <tr>
                                    <td class="border border-dark" colspan="6">
                                        <div class="itemList listLeft2 float-left" style="width: 50%;">
                                            <div class="itemSample" style="display: none; border-right: solid 1px rgb(150, 150, 150); border-bottom: solid 1px rgb(150, 150, 150); margin: 0 5px 5px; white-space: nowrap; overflow: hidden;">
                                                <span class="name" style="font-size: 1.2rem; font-weight: bold; padding-right: 3px;"></span> <span class="content" style="font-size: 1.1rem; padding-right: 5px;"></span>
                                                <span class="amount" style="font-size: 1.1rem;"></span>
                                            </div>
                                        </div>
                                        <div class="itemList listRight2 float-left" style="width: 50%;"></div>
                                    </td>
                                </tr>
                                <tr style="border-top: 2px solid black;">
                                    <td colspan="6" style="font-size: 1.35rem;">
                                        <div class="row m-0 pt-1 pb-1">
                                            <div class="col-md-1 others">
                                                <b>備註1</b>
                                            </div>
                                            <div class="col-md-5 pr-1 pl-1 othersEdit border border-dark rounded" id="note1" contenteditable="true" data-text="最多兩行(不填寫請輸入 空白)"></div>
                                            <div class="col-md-1 others">
                                                <b>備註2</b>
                                            </div>
                                            <div class="col-md-5 pr-1 pl-1 othersEdit border border-dark rounded" id="note2" contenteditable="true" data-text="最多兩行(不填寫請輸入 空白)"></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="6">
                                        <table class="table table-sm" style="border-top: 3px solid black;">
                                            <thead>
                                                <tr class="sign">
                                                    <th class="p-0" style="width: 12%;"><div class="p-0 textT2 border border-dark">Ass'y</div></th>
                                                    <th class="p-0" style="width: 11%;"><div class="p-0 textT2 border border-dark">Burn-in</div></th>
                                                    <th class="p-0" style="width: 11%;"><div class="p-0 textT2 border border-dark">T1</div></th>
                                                    <th class="p-0" style="width: 11%;"><div class="p-0 textT2 border border-dark">T2</div></th>
                                                    <th class="p-0" style="width: 11%;"><div class="p-0 textT2 border border-dark">P1</div></th>
                                                    <th class="p-0" style="width: 11%;"><div class="p-0 textT2 border border-dark">P2</div></th>
                                                    <th class="p-0" style="width: 11%;"><div class="p-0 textT2 border border-dark">QC</div></th>
                                                    <th class="p-0" style="width: 11%;"><div class="p-0 textT2 border border-dark">RF</div></th>
                                                    <th class="p-0" style="width: 11%;"><div class="p-0 textT2 border border-dark">PM</div></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="p-0"><div class="p-0 border border-dark" style="height: 60px;"></div></td>
                                                    <td class="p-0"><div class="p-0 border border-dark" style="height: 60px;"></div></td>
                                                    <td class="p-0"><div class="p-0 border border-dark" style="height: 60px;"></div></td>
                                                    <td class="p-0"><div class="p-0 border border-dark" style="height: 60px;"></div></td>
                                                    <td class="p-0"><div class="p-0 border border-dark" style="height: 60px;"></div></td>
                                                    <td class="p-0"><div class="p-0 border border-dark" style="height: 60px;"></div></td>
                                                    <td class="p-0"><div class="p-0 border border-dark" style="height: 60px;"></div></td>
                                                    <td class="p-0"><div class="p-0 border border-dark" style="height: 60px;"></div></td>
                                                    <td class="p-0"><div class="p-0 border border-dark" style="height: 60px;"></div></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td id="c2_note" colspan="6" style="font-size: 0.5rem; text-align: right; padding-right: 10px;">表單編號: QR-701-06 / 規格負責人: / 建單負責人:</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="collapse2 mt-2" id="">
                    <div class="mb-2 text-center">
                        <b>數量為100份 ,產生列印 約1分鐘 演算時間...稍後</b>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-4">
                            <div class="col-md-6 p-0 float-right">
                                <div class="row border border-primary rounded">
                                    <label class="input-group-text"> <input id="production_ok" type="checkbox" checked /></label>
                                    <div class="border pl-1">
                                        <div class="group-list-10" style="height: 24px;">
                                            <b>投入生產 和 MES導入</b>
                                        </div>
                                    </div>
                                </div>
                                <div class="row border border-primary rounded mt-1">
                                    <label class="input-group-text"> <input id="production_sn_ok" type="checkbox" checked /></label>
                                    <div class="border pl-1">
                                        <div class="group-list-10" style="height: 24px;">
                                            <b>產品SN身分 區間導入</b>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="">
                                <button id="p_submit2" class="btn btn-primary btn-block" type="button">列印內容</button>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="">
                                <button id="a_c_submit2" class="btn btn-warning btn-block" type="button">清除內容</button>
                            </div>
                        </div>
                        <div class="col-md-4"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 浮動電梯 -->
        <div class="text-center fixed-bottom m-3" style="width: 140px; font-family: Microsoft JhengHei; font-size: 16px; left: auto;">
            <div id="top" class="shadow from_move row p-2 m-2 bg-light border border-primary rounded" style="cursor: pointer;">
                <img class="col-md-3 pl-0 pr-0" alt="top" src="./thirdparty/images/move_arrow.gif" style="transform: rotate(-135deg); max-width: 25px;" />
                <div class="col-md-9 pr-0" style="max-width: 80px;">Top</div>
            </div>
            <div id="collapseAdded_1" class="shadow from_move row p-2 m-2 bg-light border border-primary rounded" style="cursor: pointer;">
                <img class="col-md-3 pl-0 pr-0" alt="流程卡" src="./thirdparty/images/move_arrow.gif" style="transform: rotate(88deg); max-width: 25px;" />
                <div class="col-md-9 pr-0" style="max-width: 80px;">流程卡</div>
            </div>
            <div id="collapseAdded_2" class="shadow from_move row p-2 m-2 bg-light border border-primary rounded" style="cursor: pointer;">
                <img class="col-md-3 pl-0 pr-0" alt="列印內容" src="./thirdparty/images/move_arrow.gif" style="transform: rotate(88deg); max-width: 25px;" />
                <div class="col-md-9 pr-0" style="max-width: 80px;">列印內容</div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    console.log("production_print_body");
    templateBody = new Vue({
        el: "#production_print_body",
        data: {
            l_search_thead: "", //鎖定查詢
            search_list: "",
            group_list: "",
            item_list: "",
            production_list: "",
            softwareVer_list: "",
            sn_all_list: "",
            pr_type: "",
            pr_w_years: "",
            ph_wpro_id: "",
            sn_all_nb: "",
            item_nb_max: 0, //最大ID數
            //分頁功能
            page_max: 100, //當前本批 筆數
            page_max_total: 100, //最大總數
            page_batch: 0, //第幾批
            page_batch_total: 100, //每批間格值
            page_every: 10, //當前每頁筆數
            page_stay: 1, //當前頁數
            //分頁功能2
            page_max2: 100, //當前本批 筆數
            page_max_total2: 100, //最大總數
            page_batch2: 0, //第幾批
            page_batch_total2: 100, //每批間格值
            page_every2: 10, //當前每頁筆數
            page_stay2: 1, //當前頁數

            s_4: 0, //當前產品ID
            d_1: "", //當前的 投線日
            d_2: "", //當前的 出貨日

            isDragging: false, //移動
        },
        created: function () {
            //初始化
            console.log(main.contentData.templateInfo.body);
            this.group_list = main.contentData.templateInfo.body["group_list"];
            this.item_list = main.contentData.templateInfo.body["item_list"];
            this.search_list = main.contentData.templateInfo.body["list"];
            this.item_nb_max = main.contentData.templateInfo.body["group_list"].length + 1;
            this.production_list = main.contentData.templateInfo.body["production_list"];
            this.softwareVer_list = main.contentData.templateInfo.body["softwareVer_list"];
            this.sn_all_list = main.contentData.templateInfo.body["sn_all_list"];
            this.pr_type = main.contentData.templateInfo.body["pr_type"];
            this.pr_w_years = main.contentData.templateInfo.body["pr_w_years"];
            this.ph_wpro_id = main.contentData.templateInfo.body["ph_wpro_id"];

            $("#group_id_0").text(this.item_nb_max);
            $("#a_item").attr("group_id", this.item_nb_max);
            //=====BOM 清單=====
            //t_choose
            var min_width = 100;
            for (var i = 0; i < this.search_list[0].length; i++) {
                var choose_check = '[<div class="text-left form-check">';
                choose_check += '<input class="form-check-input" type="checkbox" value="" id="s_' + i + '" checked>';
                choose_check += '<label class="form-check-label" for="s_' + i + '">' + this.search_list[0][i] + "</label>";
                choose_check += "</div>]";
                $("#search_choose").append(choose_check);
            }
            //t_header
            for (var i = 0; i < this.search_list[0].length; i++) {
                if (i == 0 || i == 2 || i == 5 || i == 7) {
                    min_width = 180;
                }
                if (i == 6) {
                    min_width = 150;
                }
                if (i == 10) {
                    min_width = 100;
                }
                $("#search_thead").append('<th style="min-width: ' + min_width + 'px;" class="s_' + i + '" scope="col">' + this.search_list[0][i] + "</th>");
                min_width = 80;
            }

            //=====製令 清單=====
            for (var i = 0; i < this.production_list[0].length; i++) {
                var choose_check = '[<div class="text-left form-check">';
                choose_check += '<input class="form-check-input" type="checkbox" value="" id="t_' + i + '" checked>';
                choose_check += '<label class="form-check-label" for="t_' + i + '">' + this.production_list[0][i] + "</label>";
                choose_check += "</div>]";
                $("#search_choose2").append(choose_check);
            }
            //t_header
            for (var i = 0; i < this.production_list[0].length; i++) {
                if (i == 0 || i == 2 || i == 4 || i == 6 || i == 8) {
                    min_width = 180;
                }
                if (i == 7 || i == 11 || i == 12) {
                    min_width = 150;
                }

                $("#search_thead2").append('<th style="min-width: ' + min_width + 'px;" class="t_' + i + '" scope="col">' + this.production_list[0][i] + "</th>");
                min_width = 80;
            }

            //sn_all_list(SN序號規則)
            var sn_group = 0;
            var p_s_sn_id = "";
            var p_o_sn = "";

            for (var i = 0; i < this.sn_all_list.length; i++) {
                var sn = this.sn_all_list[i];
                //排除基本規則(建立類數量)
                if (sn.sn_group > 0 && sn_group != sn.sn_group) {
                    sn_group = sn.sn_group;
                    var p_s_sn = $(".production_sn").clone();
                    p_s_sn.removeClass("d-none");
                    p_s_sn.removeClass("production_sn");
                    p_s_sn.attr("id", "g_" + sn["sn_group"]);
                    p_s_sn.find(".option_sn").text(sn.sn_group_name);
                    p_s_sn.appendTo("#sn_p");
                    p_s_sn_id = "g_" + sn["sn_group"];
                } else if (sn.sn_group == 0) {
                    continue;
                }
                //建立項目
                var p_o_sn = $(".production_sn .option_sn").clone();
                p_o_sn.addClass("g_o_" + sn.sn_group);
                p_o_sn.removeClass("option_sn");
                p_o_sn.attr("id", sn.sn_id);
                p_o_sn.attr("value", sn.sn_value);
                p_o_sn.text(sn.sn_name);
                p_o_sn.removeAttr("selected", " ");
                p_o_sn.appendTo("#" + p_s_sn_id + " select");
            }
            //建立製令單類型

            for (var type_one = 0; type_one < this.pr_type.length; type_one++) {
                var production_t_no = $(".production_t_no").clone();
                production_t_no.removeClass("production_t_no");
                production_t_no.attr("id", this.pr_type[type_one].key);
                production_t_no.attr("value", this.pr_type[type_one].key);
                production_t_no.text(this.pr_type[type_one].value);
                production_t_no.removeAttr("selected", " ");
                production_t_no.appendTo("#pr_type");
            }
            //建立保固年分
            for (var pr_w_years_one = 0; pr_w_years_one < this.pr_w_years.length; pr_w_years_one++) {
                var pr_w_years_no = $(".pr_w_years_no").clone();
                pr_w_years_no.removeClass("pr_w_years_no");
                pr_w_years_no.attr("id", this.pr_w_years[pr_w_years_one].key);
                pr_w_years_no.attr("value", this.pr_w_years[pr_w_years_one].key);
                pr_w_years_no.text(this.pr_w_years[pr_w_years_one].value);
                pr_w_years_no.removeAttr("selected", " ");
                pr_w_years_no.appendTo("#pr_w_years");
            }
            //建立工作站程序
            if (this.ph_wpro_id != null) {
                for (var ph_wpro_id_one = 0; ph_wpro_id_one < this.ph_wpro_id.length; ph_wpro_id_one++) {
                    var ph_wpro_id_no = $(".ph_wpro_id_no").clone();
                    ph_wpro_id_no.removeClass("ph_wpro_id_no");
                    ph_wpro_id_no.attr("id", this.ph_wpro_id[ph_wpro_id_one].key);
                    ph_wpro_id_no.attr("value", this.ph_wpro_id[ph_wpro_id_one].key);
                    ph_wpro_id_no.text(this.ph_wpro_id[ph_wpro_id_one].value);
                    ph_wpro_id_no.removeAttr("selected", " ");
                    ph_wpro_id_no.appendTo("#ph_wpro_id");
                }
            }

            //t_body
            this.search_update();
            this.production_update();
            //t_body_group
            this.group_choose();
            //建立 選項
            this.group_item_choose("s_g_item", -1);
            this.group_item_choose("a_g_item_0", 0);

            //動態監聽顯示是否用 客製化SN
            $(document).on("click", "#sn_customized_ok", function (event) {
                if ($("#sn_customized_ok").prop("checked")) {
                    $("#sn_p .p-1").attr("disabled", "disabled");
                } else {
                    $("#sn_p .p-1").removeAttr("disabled");
                }
            });
            //動態監聽顯示Table 物件 查看開關
            $(document).on("click", "#search_choose input", function (event) {
                templateBody.search_choose(event);
            });
            //動態監聽production_ok 投入生產 是否有點及勾選
            $(document).on("click", "#production_ok", function (event) {
                console.log($("#production_ok").prop("checked"));
                if ($("#production_ok").prop("checked")) {
                    $("#production_sn_ok").removeAttr("disabled");
                } else {
                    if ($("#production_sn_ok").prop("checked")) {
                        $("#production_sn_ok").trigger("click");
                    }
                    $("#production_sn_ok").attr("disabled", "disabled");
                }
            });
            //查詢監聽
            $(document).on("click", "#s_submit", function (event) {
                //頁數-重製分頁
                templateBody.change_page_init();
                templateBody.send_search("");
            });
            //查詢監聽2
            $(document).on("click", "#s_submit2", function (event) {
                //頁數-重製分頁
                //  templateBody.change_page_init2();
                templateBody.send_search("production");
            });
            //清除修改
            $(document).on("click", "#a_c_submit2", function (event) {
                templateBody.rm_added2();
            });

            //頁數-重製分頁
            $(document).on("click", "#p_submit2", function (event) {
                //templateBody.change_page_init2();
                templateBody.send_search("update");
            });
            //移動
            $(document).on("click", ".from_move", function (event) {
                templateBody.from_move(event);
            });

            //切換項目 監聽
            $(document).on("change", "#s_g_item", function (event) {
                templateBody.item_choose(event, -1);
            });

            //新增監聽
            $(document).on("click", "#a_item", function (event) {
                templateBody.added_item();
            });
            // 條件清除
            $(document).on("click", "#s_c_submit", function (event) {
                templateBody.rm_select();
            });
            // 條件清除
            $(document).on("click", "#s_c_submit2", function (event) {
                templateBody.rm_select2();
            });
            //條件鎖定
            $(document).on("click", "#s_l_submit", function (event) {
                templateBody.lk_select();
            });
            //日期
            $(document).ready(function (event) {
                $("#datepicker1 input").datepicker({
                    dateFormat: "yy/mm/dd",
                    minDate: 0,
                });
            });
            $(document).ready(function (event) {
                $("#datepicker2 input").datepicker({
                    dateFormat: "yy/mm/dd",
                    minDate: 0,
                });
            });
            //客戶欄位
            $(document).on("focusout", "#client_name", function (event) {
                templateBody.sofwareVer_in();
            });
            //產品SN選單
            $(document).on("change", ".select_sn", function (event) {
                templateBody.select_sn();
            });

            //barcode 觸發(工單號)
            var lastContent = "";
            $(document).on("focusin", "#barcodeInput", function (event) {
                lastContent = this.innerHTML;
            });
            $(document).on("focusout", "#barcodeInput", function (event) {
                templateBody.createBarcode(this.innerHTML);
            });
            $(document).on("keyup", "#barcodeInput", function (event) {
                if (event.keyCode == 13) {
                    this.innerHTML = lastContent;
                    templateBody.createBarcode(this.innerHTML);
                } else {
                    lastContent = this.innerHTML;
                }
            });
        },
        methods: {
            search_choose: function (event) {
                console.log(event.target.checked);
                if (!event.target.checked) {
                    $("#search_thead ." + event.target.id).hide();
                    $("#search_tbody ." + event.target.id).hide();
                } else {
                    $("#search_thead ." + event.target.id).show();
                    $("#search_tbody ." + event.target.id).show();
                }
            },
            //查詢更新
            search_update: function () {
                $("#search_tbody").empty();
                //頁數-刷新
                this.change_page_update();
                //t_body
                var checked = 10;
                var kind = 11;
                for (var i = 1; i < this.search_list.length; i++) {
                    //頁數-每頁顯示(不再顯示範圍內則隱藏)
                    var page_group = this.change_page_btn(i);
                    //功能
                    var s_list = this.search_list[i][4];

                    var a_submit = '<div class="md-6">';
                    a_submit += '<button user_id="' + s_list + '" class="btn btn-warning btn-sm btn-block a_submit">';
                    a_submit += "預覽</button></div>";
                    //有列印過的-
                    var success_color = "bg-light";
                    //只技轉中
                    var text_r = " text-danger";
                    //可量產
                    var text_g = " text-success";

                    this.search_list[i][checked] != "" ? (success_color = "bg-light font-weight-bold") : (success_color = "");
                    this.search_list[i][kind] == 0 ? (success_color += text_r) : (success_color += text_g);
                    $("#search_tbody").append('<tr class=" page_all  t_row' + s_list + " " + page_group + '" style="white-space: nowrap;"><th class="ml-0 col-md-12 row">' + a_submit + "</th></tr>");
                    //計數量
                    $("#search_tbody .t_row" + this.search_list[i][4]).append("<td >" + i + "</td>");

                    for (var j = 0; j < this.search_list[i].length; j++) {
                        var color = "";
                        if (j == 5) color = success_color;

                        $("#search_tbody .t_row" + s_list).append("<td class='s_" + j + " " + color + "' >" + this.search_list[i][j] + "</td>");
                    }
                }
                //預覽監聽
                $(document).off("click", ".a_submit");
                $(document).on("click", ".a_submit", function (event) {
                    templateBody.choose_show("資料顯示", event, null);
                    if ($("#collapse_report a").attr("aria-expanded") == "false") {
                        $("#collapse_report a").trigger("click");
                    }
                    if ($("#collapse_search_btn a").attr("aria-expanded") == "false") {
                        $("#collapse_search_btn a").trigger("click");
                    }
                    setTimeout(function () {
                        $("html,body").animate(
                            {
                                scrollTop: 1110,
                            },
                            "slow"
                        );
                    }, 500);
                });
            },
            //查詢-製令更新
            production_update: function () {
                $("#search_tbody2").empty();
                //頁數-刷新
                this.change_page_update2();
                //t_body
                var checked = 10;
                var kind = 11;
                for (var i = 1; i < this.production_list.length; i++) {
                    //頁數-每頁顯示(不再顯示範圍內則隱藏)
                    var page_group = this.change_page_btn2(i);
                    //功能
                    var s_list = this.production_list[i][4];

                    var a_submit = '<div class="md-6">';
                    a_submit += '<button user_id="' + s_list + '" class="btn btn-warning btn-sm btn-block a_submit2">';
                    a_submit += "預覽</button></div>";

                    $("#search_tbody2").append('<tr class=" page_all2  t_row2' + s_list + " " + page_group + ' " style="white-space: nowrap;"><th class="ml-0 col-md-12 row">' + a_submit + "</th></tr>");
                    //計數量
                    $("#search_tbody2 .t_row2" + this.production_list[i][4]).append("<td >" + i + "</td>");

                    for (var j = 0; j < this.production_list[i].length; j++) {
                        $("#search_tbody2 .t_row2" + s_list).append("<td class='s_" + j + "' >" + this.production_list[i][j] + "</td>");
                    }
                }
                //預覽監聽
                $(document).off("click", ".a_submit2");
                $(document).on("click", ".a_submit2", function (event) {
                    var id_p = event.target.attributes.user_id.value;
                    templateBody.event = event;
                    //自動_先檢查是否有效
                    $("#a_c_submit2").trigger("click");
                    $("#s_c_submit").trigger("click");
                    $("#s_bom_id").val($(".t_row2" + id_p + " .s_5").text());
                    $("#s_bom_number").val($(".t_row2" + id_p + " .s_6").text());
                    $("#s_l_submit").trigger("click");
                    $("#s_submit").trigger("click");

                    //進行預覽
                    setTimeout(function () {
                        templateBody.choose_show("資料顯示", null, event);
                        templateBody.event = "";
                    }, 2500);

                    if ($("#collapse_report a").attr("aria-expanded") == "false") {
                        $("#collapse_report a").trigger("click");
                    }
                    if ($("#collapse_search_btn2 a").attr("aria-expanded") == "false") {
                        $("#collapse_search_btn2 a").trigger("click");
                    }
                    setTimeout(function () {
                        $("html,body").animate(
                            {
                                scrollTop: 1000,
                            },
                            "slow"
                        );
                    }, 500);
                });

                //sn_all_list(SN序號規則)
                var sn_group = 0;
                var p_s_sn_id = "";
                var p_o_sn = "";
                //清除
                for (var i = 0; i < this.sn_all_list.length; i++) {
                    $("#g_" + i).remove();
                }

                for (var i = 0; i < this.sn_all_list.length; i++) {
                    var sn = this.sn_all_list[i];
                    //排除基本規則(建立類數量)
                    if (sn.sn_group > 0 && sn_group != sn.sn_group) {
                        sn_group = sn.sn_group;
                        var p_s_sn = $(".production_sn").clone();
                        p_s_sn.removeClass("d-none");
                        p_s_sn.removeClass("production_sn");
                        p_s_sn.attr("id", "g_" + sn["sn_group"]);
                        p_s_sn.find(".option_sn").text(sn.sn_group_name);
                        p_s_sn.appendTo("#sn_p");
                        p_s_sn_id = "g_" + sn["sn_group"];
                    } else if (sn.sn_group == 0) {
                        continue;
                    }
                    //建立項目
                    var p_o_sn = $(".production_sn .option_sn").clone();
                    p_o_sn.addClass("g_o_" + sn.sn_group);
                    p_o_sn.removeClass("option_sn");
                    p_o_sn.attr("id", sn.sn_id);
                    p_o_sn.attr("value", sn.sn_value);
                    p_o_sn.text(sn.sn_name);
                    p_o_sn.removeAttr("selected", " ");
                    p_o_sn.appendTo("#" + p_s_sn_id + " select");
                }
            },
            //選擇群組-並建立監聽
            group_choose: function () {
                var group = "";
                $("#a_u_group_name select").empty();
                group += '<option value="">請選擇</option>';
                $.each(this.search_group, function (index, val) {
                    group += "<option value=" + val + ">" + index + "</option>";
                });
                $("#a_u_group_name select").append(group);

                $(document).on("change", "#a_u_group_name select", function (event) {
                    $("#a_u_group_id").text(event.target.value);
                });
            },

            //移動電梯
            from_move: function (event) {
                console.log(event.currentTarget.id);
                switch (event.currentTarget.id) {
                    case "top":
                        setTimeout(function () {
                            $("html,body").animate(
                                {
                                    scrollTop: 80,
                                },
                                "slow"
                            );
                        }, 500);
                        break;
                    case "collapseAdded_1":
                        if ($("#collapse_report a").attr("aria-expanded") == "false") {
                            $("#collapse_report a").trigger("click");
                        }
                        setTimeout(function () {
                            $("html,body").animate(
                                {
                                    scrollTop: 990,
                                },
                                "slow"
                            );
                        }, 500);
                        break;
                    case "collapseAdded_2":
                        if ($("#collapse_report a").attr("aria-expanded") == "false") {
                            $("#collapse_report a").trigger("click");
                        }
                        setTimeout(function () {
                            $("html,body").animate(
                                {
                                    scrollTop: 2110,
                                },
                                "slow"
                            );
                        }, 500);
                        break;
                    default:
                        break;
                }
            },
            //選擇項目
            item_choose: function (event, who) {
                var s_i_item = "";
                for (var i = 0; i < templateBody.item_list.length; i++) {
                    if (templateBody.item_list[i][0] == event.target.value) {
                        var value_i = "";
                        //項目
                        if (templateBody.item_list[i][2] == 1) {
                            value_i += "--| ";
                            for (var j = 4; j < templateBody.item_list[i].length - 1; j++) {
                                value_i += templateBody.item_list[i][j] + " | ";
                            }
                            value_i += "--";
                            s_i_item += "<option value=''>" + value_i + "</option>";
                        } else {
                            //內容
                            value_i += "| ";
                            for (var j = 4; j < templateBody.item_list[i].length - 1; j++) {
                                value_i += templateBody.item_list[i][j] + " | ";
                            }
                            s_i_item += "<option value='" + templateBody.item_list[i][2] + "'>" + value_i + "</option>";
                        }
                    }
                }
                //沒選擇的話
                if (s_i_item == "") {
                    s_i_item = "<option value=''>請選擇</option>";
                }
                //如果是 "新增選擇" 的話 a_i_item_
                if (who > -1) {
                    $("#item_id_" + who).text("");
                    $("#item_group_id_" + who).text(event.target.value);
                    $("#a_i_item_" + who).empty();
                    $("#a_i_item_" + who).append(s_i_item);
                } else {
                    //如果是 "查詢選擇" 的話 s_i_item
                    $("#s_i_item").empty();
                    $("#s_i_item").append(s_i_item);
                }
            },
            //選擇 群組-項目
            group_item_choose: function (id, def) {
                //s_choose s_g_item
                var s_g_item = "<option value=''>請選擇</option>";
                var group_name = "";
                for (var i = 0; i < this.item_list.length; i++) {
                    if (group_name != this.item_list[i][1]) {
                        s_g_item += "<option value='" + this.item_list[i][0] + "'>" + this.item_list[i][1] + "</option>"; //群組
                        group_name = this.item_list[i][1];
                    }
                }
                $("#" + id).empty();
                $("#" + id).append(s_g_item);
            },
            //更新 項目ID
            item_one_choose: function (event) {
                $("#item_id_" + event.target.attributes.item_id.value).text(event.target.value);
            },
            rm_added2: function () {
                $("#BOMID").text("");
                $("#kind2").text("");
                $("#client_name").text("");

                $("#barcodeOutput div").remove();

                $("#group_number_0").val(1);
                $("#barcodeInput").text("");
                $("#datepicker1 input").val("");
                $("#datepicker2 input").val("");
                $(".textN1").text("");
                $(".textN2").text("");
                $(".coll2").text("");
                $(".othersEdit").text("");
                $("#barcodeOutputSn").text("");

                $("#collapseAdded2 .itemList .item").remove();
            },
            //清除選擇
            rm_select: function () {
                $("#s_l_list").empty();
                $("#s_l_list").append('<div class="text-left mb-2 mt-2">條件清單:</div>');
                $("#s_model").val("");
                $("#s_bom_id").val("");
                $("#s_bom_number").val("");
                $("#s_g_item").val("").trigger("change");
            },
            //清除選擇
            rm_select2: function () {
                $("#s_id").val("");
                $("#s_model2").val("");
                $("#s_bom_number2").val("");
            },
            //鎖定~
            lk_select: function () {
                var lk = "{";
                lk += "'g_item':'" + $("#s_g_item").val() + "',";
                lk += "'i_item':'" + $("#s_i_item").val() + "',";
                lk += "'p_model':'" + $("#s_model").val() + "',";
                lk += "'p_bom_id':'" + $("#s_bom_id").val() + "',";
                lk += "'p_bom_number':'" + $("#s_bom_number").val() + "'}";

                $("#s_l_list").append('<div class="text-left mb-2 mt-2">' + lk + "</div>");
                //清除選擇
                $("#s_model").val("");
                $("#p_bom_id").val("");
                $("#s_bom_number").val("");
                $("#s_g_item").val("").trigger("change");
            },
            //選擇  預覽
            choose_show: function (a_u_type, event, production) {
                this.rm_added2();
                var id_p = "";
                var id = "";
                var come_from = "自訂";
                if (event == null) {
                    //自動帶入
                    id_p = production.target.attributes.user_id.value;
                    id = $(".t_row2" + id_p + " .s_5").text();
                    //先檢查是否有效
                    if ($(".t_row" + id + " .s_4").length == 0) {
                        main.alertshow(true, "尚未比對到[產品規格]資料,Step1.請在[產品規格]的[BOM料號]查詢 後,Step2.再[製令生產]進行[預覽]!!");
                        return;
                    }
                    //項目帶入
                    $("#barcodeInput").text($(".t_row2" + id_p + " .s_4").text());
                    $("#client_name").text($(".t_row2" + id_p + " .s_9").text());
                    $("#order_id").text($(".t_row2" + id_p + " .s_8").text());
                    $("#p_number").text($(".t_row2" + id_p + " .s_7").text());
                    $("#barcodeInput").trigger("focusout");
                    $("#barcodeInput").attr("contenteditable", false);
                    $("#order_id").attr("contenteditable", false);
                    $("#client_name").attr("contenteditable", false);
                    $("#p_number").attr("contenteditable", true);

                    come_from = $(".t_row2" + id_p + " .s_12").text();
                } else {
                    //自定義
                    $("#barcodeInput").attr("contenteditable", true);
                    $("#order_id").attr("contenteditable", true);
                    $("#client_name").attr("contenteditable", true);
                    $("#p_number").attr("contenteditable", true);
                    id = event.target.attributes.user_id.value;
                }

                //共用欄位位
                this.s_4 = $(".t_row" + id + " .s_4")[0].innerText;
                $("#a_u_version_motherboard").text($(".t_row" + id + " .s_8")[0].innerText);
                $("#BOMID").text($(".t_row" + id + " .s_7")[0].innerText);
                if ($(".t_row" + id + " .s_11")[0].innerText == 1) {
                    $("#kind2").text("量產單");
                } else {
                    $("#kind2").text("技轉單");
                }
                //比對軟體
                this.sofwareVer_in();

                //規格定義
                var group_tbody = "";
                var $listLeft = $("#collapseAdded2 .listLeft2");
                var $listRight = $("#collapseAdded2 .listRight2");
                var $sample = $listLeft.find(".itemSample");
                $listLeft.add($listRight).find(".item").remove();
                var indexItemId = 5;
                var indexId = 6;
                var indexAmount = 8;
                var indexOrder = 9;
                var indexName = 11;
                var indexContent = 12;
                var $target = $listLeft;
                var counting = 0;
                var columnItemNumber = 25;
                this.group_list.sort(function (a, b) {
                    return b[indexOrder] - a[indexOrder];
                });
                //規格生成
                for (var i = 0; i < this.group_list.length; i++) {
                    if (id == this.group_list[i][indexItemId] && this.group_list[i][indexId] != 1) {
                        if (this.group_list[i][indexAmount] == 0) continue;
                        var $new = $sample.clone().show().removeClass("itemSample").addClass("item");
                        $new.find(".name").html(this.group_list[i][indexName] + ":");
                        var tmp = [];
                        for (var n = indexContent; n < this.group_list[i].length; n++) {
                            tmp.push(this.group_list[i][n]);
                        }
                        $new.find(".content").html(tmp.join(" "));
                        if (this.group_list[i][indexAmount] > 1) {
                            $new.find(".amount").html("(x" + this.group_list[i][indexAmount] + ")");
                        }
                        if (++counting > columnItemNumber) $target = $listRight;
                        $target.append($new);
                    }
                }
                $("#collapseAdded2 .listLeft2").add($("#collapseAdded2 .listRight2")).find(".item").css("margin-bottom", "1px").find(".content").css("font-size", "1.3rem");
                $('#collapseAdded input[type="checkbox"]').change(function () {
                    var checked = $(this).prop("checked");
                    if (checked) {
                        $(this).after('<input type="checkbox" checked="checked">');
                    } else {
                        $(this).after('<input type="checkbox">');
                    }
                    $(this).remove();
                });
                //底部
                var fullDate = new Date();
                var twoDigitMonth = fullDate.getMonth() + 1 >= 10 ? fullDate.getMonth() + 1 : "0" + (fullDate.getMonth() + 1);
                var currentDate = fullDate.getFullYear() + "-" + twoDigitMonth + "-" + fullDate.getDate();
                $("#c2_note").text("表單編號:QR-701-06 / 規格負責人 : " + $(".t_row" + id + " .s_3")[0].innerText + " / 建單日期 : " + currentDate + " / 建單人 : " + $("#nav_account").text() + " / 單據來源 : " + come_from);

                //可拖曳位置(方便站台排序)
                $(".itemList ").sortable();
                $(".itemList ").disableSelection();
            },
            //比對規格->自動帶入軟體定義
            sofwareVer_in: function () {
                //console.log( this.softwareVer_list[$("#client_name").text()+"-"+ $("#BOMID").text()]);
                var software_in = this.softwareVer_list[$("#client_name").text() + "-" + $("#BOMID").text()];
                if (software_in != null && software_in.length > 0) {
                    var mb_ver_4 = 4;
                    $("#mb_ver").text(software_in[4]);
                    $("#mb_ver_ecn").text(software_in[5]);
                    $("#nvram").text(software_in[6]);
                    $("#bios").text(software_in[7]);
                    $("#product_model_in").text(software_in[8]);
                    $("#ec").text(software_in[9]);
                    $("#os").text(software_in[10]);
                    $("#note").text(software_in[11]);
                    $("#note1").text(software_in[12]);
                    $("#note2").text(software_in[13]);
                } else {
                    $("#mb_ver").text("");
                    $("#mb_ver_ecn").text("");
                    $("#nvram").text("");
                    $("#bios").text("");
                    $("#product_model_in").text("");
                    $("#ec").text("");
                    $("#os").text("");
                    $("#note").text("");
                    $("#note1").text("");
                    $("#note2").text("");
                }
            },
            //select_sn 選單
            select_sn: function () {
                var rules = "";
                var select_sn = $(".select_sn");
                for (var i = 1; i < select_sn.length; i++) {
                    rules += $("#g_" + i + " select")
                        .children("option:selected")
                        .val();
                }
                $("#p_sn_rule").text(rules);
            },
            //頁數-初始化(新增 or 修改 or 刪除 or 條件 要重製)
            change_page_init: function () {
                //active 更換為第一格
                var a = "active";
                var d = "disabled";
                $("#page-group .page-item").removeClass(a);
                $("#page-group .page-item").removeClass(d);
                for (var re_page = 1; re_page <= 10; re_page++) {
                    var now_page = re_page + this.page_batch * 10;
                    //如果就在第一頁 不需更換
                    if (!$(".p" + now_page).hasClass("p" + re_page)) {
                        $(".p" + now_page).addClass("p" + re_page);
                        $(".p" + re_page).removeClass("p" + now_page);
                        $(".p" + re_page + " a").text(re_page);
                        $(".p" + re_page + " a").attr("id", "p" + re_page);
                    }
                    if (re_page == 1) {
                        $(".p" + now_page).addClass(a);
                    }
                }
                //分頁功能
                this.page_max = 100; //當前本批 筆數
                this.page_max_total = 100; //最大總數
                this.page_batch = 0; //第幾批
                this.page_batch_total = 100; //每批間格值
                this.page_every = 10; //當前每頁筆數
                this.page_stay = 1; //當前頁數
            },
            //頁數-刷新
            change_page_update: function () {
                //頁數-取得當前最大筆數 && 頁數
                this.page_max = this.search_list.length;
                $(".p_n").removeClass("disabled");
                if (this.page_max < this.page_max_total) {
                    $(".p_n").addClass("disabled");
                }
                $(".p_p").removeClass("disabled");
                if (this.page_batch < 1) {
                    $(".p_p").addClass("disabled");
                }
                //頁數-隱藏多於頁數
                $(".p_nb").addClass("disabled");
            },
            //頁數-換頁按鈕建置(頁數-每頁顯示)
            change_page_btn: function (i) {
                var d_none = "";
                if (i > this.page_every * this.page_stay) {
                    d_none = "d-none";
                }
                //頁數-(個位數)+(十位數)
                var page_group = "pg_" + (Math.floor((i - 1) / this.page_every) + 1 + this.page_batch * 10);
                var page_nb = "p" + (Math.floor((i - 1) / this.page_every) + 1 + this.page_batch * 10);
                $("." + page_nb).removeClass("disabled");
                return page_group + " " + d_none;
            },
            //頁數-換頁查詢
            change_page: function (event) {
                var d = "disabled";
                var d_n = "d-none";
                var a = "active";
                var pg = "pg_";
                console.log("page btn is:" + event.text);
                //選定頁數
                if (event.id != "p_p" && event.id != "p_n") {
                    $("#page-group .page-item").removeClass(a);
                    $("." + event.id).addClass(a);

                    $(".page_all").addClass(d_n);
                    $("." + pg + event.text).removeClass(d_n);
                } else if (event.id == "p_p") {
                    //上10頁(批數 要大於1)
                    if (this.page_batch > 0) {
                        //換上一批次 頁數
                        $("#page-group .page-item").removeClass(a);

                        for (var i = 1; i <= 10; i++) {
                            var now_page = i + this.page_batch * 10;
                            var previous_page = i + this.page_batch * 10 - 10;
                            $(".p" + now_page).addClass("p" + previous_page);
                            $(".p" + previous_page).removeClass("p" + now_page);
                            $(".p" + previous_page + " a").text(previous_page);
                            $(".p" + previous_page + " a").attr("id", "p" + previous_page);
                            if (i == 1) {
                                $(".p" + previous_page).addClass(a);
                            }
                        }
                        this.page_batch -= 1;
                        this.send_search("");
                    }
                } else if (event.id == "p_n") {
                    //下10頁(必須滿100筆最大量 )
                    if (this.page_max >= this.page_max_total) {
                        //換下一批次 頁數
                        $("#page-group .page-item").removeClass(a);

                        for (var i = 1; i <= 10; i++) {
                            var now_page = i + this.page_batch * 10;
                            var next_page = i + (this.page_batch + 1) * 10;
                            $(".p" + now_page).addClass("p" + next_page);
                            $(".p" + next_page).removeClass("p" + now_page);
                            $(".p" + next_page + " a").text(next_page);
                            $(".p" + next_page + " a").attr("id", "p" + next_page);
                            if (i == 1) {
                                $(".p" + next_page).addClass(a);
                            }
                        }
                        this.page_batch += 1;
                        this.send_search("");
                    }
                }
                return false;
            },
            //頁數-初始化(新增 or 修改 or 刪除 or 條件 要重製)
            change_page_init2: function () {
                //active 更換為第一格
                var a = "active";
                var d = "disabled";
                $("#page-group2 .page-item").removeClass(a);
                $("#page-group2 .page-item").removeClass(d);
                for (var re_page = 1; re_page <= 10; re_page++) {
                    var now_page = re_page + this.page_batch2 * 10;
                    //如果就在第一頁 不需更換
                    if (!$(".p2_" + now_page).hasClass("p2_" + re_page)) {
                        $(".p2_" + now_page).addClass("p2_" + re_page);
                        $(".p2_" + re_page).removeClass("p2_" + now_page);
                        $(".p2_" + re_page + " a").text(re_page);
                        $(".p2_" + re_page + " a").attr("id", "p2_" + re_page);
                    }
                    if (re_page == 1) {
                        $(".p2_" + now_page).addClass(a);
                    }
                }
                //分頁功能
                this.page_max2 = 100; //當前本批 筆數
                this.page_max_total2 = 100; //最大總數
                this.page_batch2 = 0; //第幾批
                this.page_batch_total2 = 100; //每批間格值
                this.page_every2 = 10; //當前每頁筆數
                this.page_stay2 = 1; //當前頁數
            },
            //頁數-刷新
            change_page_update2: function () {
                //頁數-取得當前最大筆數 && 頁數
                this.page_max2 = this.production_list.length;
                $(".p_n2").removeClass("disabled");
                if (this.page_max2 < this.page_max_total2) {
                    $(".p_n2").addClass("disabled");
                }
                $(".p_p2").removeClass("disabled");
                if (this.page_batch2 < 1) {
                    $(".p_p2").addClass("disabled");
                }
                //頁數-隱藏多於頁數
                $(".p_nb2").addClass("disabled");
            },
            //頁數-換頁按鈕建置(頁數-每頁顯示)
            change_page_btn2: function (i) {
                var d_none = "";
                if (i > this.page_every2 * this.page_stay2) {
                    d_none = "d-none";
                }
                //頁數-(個位數)+(十位數)
                var page_group = "pg2_" + (Math.floor((i - 1) / this.page_every2) + 1 + this.page_batch2 * 10);
                var page_nb = "p2_" + (Math.floor((i - 1) / this.page_every2) + 1 + this.page_batch2 * 10);
                $("." + page_nb).removeClass("disabled");
                return page_group + " " + d_none;
            },
            //頁數-換頁查詢
            change_page2: function (event) {
                var d = "disabled";
                var d_n = "d-none";
                var a = "active";
                var pg = "pg2_";
                console.log("page btn is:" + event.text);
                //選定頁數
                if (event.id != "p_p2" && event.id != "p_n2") {
                    $("#page-group2 .page-item").removeClass(a);
                    $("." + event.id).addClass(a);

                    $(".page_all2").addClass(d_n);
                    $("." + pg + event.text).removeClass(d_n);
                } else if (event.id == "p_p2") {
                    //上10頁(批數 要大於1)
                    if (this.page_batch2 > 0) {
                        //換上一批次 頁數
                        $("#page-group2 .page-item").removeClass(a);

                        for (var i = 1; i <= 10; i++) {
                            var now_page = i + this.page_batch2 * 10;
                            var previous_page = i + this.page_batch2 * 10 - 10;
                            $(".p2_" + now_page).addClass("p2_" + previous_page);
                            $(".p2_" + previous_page).removeClass("p2_" + now_page);
                            $(".p2_" + previous_page + " a").text(previous_page);
                            $(".p2_" + previous_page + " a").attr("id", "p2_" + previous_page);
                            if (i == 1) {
                                $(".p2_" + previous_page).addClass(a);
                            }
                        }
                        this.page_batch2 -= 1;
                        this.send_search("production");
                    }
                } else if (event.id == "p_n2") {
                    //下10頁(必須滿100筆最大量 )
                    if (this.page_max2 >= this.page_max_total2) {
                        //換下一批次 頁數
                        $("#page-group2 .page-item").removeClass(a);
                        for (var i = 1; i <= 10; i++) {
                            var now_page = i + this.page_batch2 * 10;
                            var next_page = i + (this.page_batch2 + 1) * 10;
                            $(".p2_" + now_page).addClass("p2_" + next_page);
                            $(".p2_" + next_page).removeClass("p2_" + now_page);
                            $(".p2_" + next_page + " a").text(next_page);
                            $(".p2_" + next_page + " a").attr("id", "p2_" + next_page);
                            if (i == 1) {
                                $(".p2_" + next_page).addClass(a);
                            }
                        }
                        this.page_batch2 += 1;
                        this.send_search("production");
                    }
                }
                return false;
            },
            //傳送 查詢
            send_search: function (select) {
                var content = new Object();
                var search_list = [];
                var order = "search_update"; //指令
                var url = "";

                switch (select) {
                    case "": //BOM 查詢
                        for (var i = 1; i < $("#s_l_list div").length; i++) {
                            search_list.push($("#s_l_list div")[i].innerText);
                        }
                        content.page_nb = this.page_batch * this.page_batch_total; //批次(起始數)
                        content.page_total = this.page_batch_total; //(每次要的最大數量)

                        content.search_list = search_list;
                        content.product_id = templateBody.s_4;
                        content.user = $("#nav_account").text();
                        url = "./production_print.do";
                        break;
                    case "update": //更新進度
                        //有勾選->登記
                        if ($("#production_ok").prop("checked")) {
                            //製令流程(更新)
                            content.production_id = $("#barcodeInput").text();
                            content.product_progress = 3;

                            //登記(自訂單的話) 新增單據
                            content.order_id = $("#order_id").text();
                            content.client_name = $("#client_name").text();

                            var quantity = 0;
                            if ($("#p_number").text() != "" && $.isNumeric($("#p_number").text())) {
                                quantity = $("#p_number").text();
                            }

                            content.production_quantity = quantity;
                            content.bom_product_id = $("#BOMID").text();
                            //內容
                            content.bom_id = this.s_4;
                            content.product_model = $(".t_row" + this.s_4 + " .s_5").text();
                            content.version_motherboard = $(".t_row" + this.s_4 + " .s_6").text();
                            content.come_from = "流程卡";
                            content.production_quantity = quantity;
                            //軟體定義項目
                            content.mb_ver = $("#mb_ver").text();
                            content.mb_ver_ecn = $("#mb_ver_ecn").text();
                            content.nvram = $("#nvram").text();
                            content.bios = $("#bios").text();
                            content.product_model_in = $("#product_model_in").text();
                            content.ec = $("#ec").text();
                            content.os = $("#os").text();
                            content.note = $("#note").text();
                            content.note1 = $("#note1").text();
                            content.note2 = $("#note2").text();
                            content.software_id = 0;
                            //MES 補充資訊
                            content.pr_type = $("#pr_type").val();
                            content.pr_w_years = $("#pr_w_years").val();
                            content.ph_wpro_id = $("#ph_wpro_id").val();
                            //SN 登記演算
                            var sn_array = [];
                            if ($("#production_sn_ok").prop("checked")) {
                                var select_sn = $(".select_sn");
                                for (var i = 1; i < select_sn.length; i++) {
                                    var sn_obg = new Object();
                                    var sn_v = $("#g_" + i + " select")
                                        .children("option:selected")
                                        .val();
                                    var sn_n = $("#g_" + i + " select")
                                        .children("option:selected")
                                        .text();
                                    var sn_g = $("#g_" + i + " select")
                                        .children("option:selected")[0]
                                        .className.replace("g_o_", "");
                                    var sn_i = $("#g_" + i + " select").children("option:selected")[0].id;
                                    //檢驗失敗
                                    if (sn_g == "option_sn" && !$("#sn_customized_ok").prop("checked")) {
                                        main.alertshow(true, "[流程卡][SN]尚未填寫完整,請再次檢查清楚!!");
                                        return;
                                    }
                                    sn_obg.sn_group = sn_g;
                                    sn_obg.sn_name = sn_n;
                                    sn_obg.sn_value = sn_v;
                                    sn_obg.sn_id = sn_i;
                                    sn_array[i - 1] = sn_obg;
                                }
                            }
                            //有客製化SN
                            if ($("#sn_customized_ok").prop("checked")) {
                            	/*var sn_obg0 = {'sn_group': 1, 'sn_name': '0000', 'sn_value': '000', 'sn_id': '000'};
                            	var sn_obg1 = {'sn_group': 2, 'sn_name': '0000', 'sn_value': '0', 'sn_id': '000'};
                            	var sn_obg2 = {'sn_group': 3, 'sn_name': '0000', 'sn_value': '0', 'sn_id': '000'};
                            	var sn_obg3 = {'sn_group': 4, 'sn_name': '0000', 'sn_value': '[YYWW]', 'sn_id': '000'};
                            	var sn_obg4 = {'sn_group': 5, 'sn_name': '000', 'sn_value': '0', 'sn_id': '000'};
                            	var sn_obg5 = {'sn_group': 6, 'sn_name': '000', 'sn_value': '[000]', 'sn_id': '000'};
                            	
                            	sn_array[0] =sn_obg0;
                            	sn_array[1] =sn_obg1;
                            	sn_array[2] =sn_obg2;
                            	sn_array[3] =sn_obg3;
                            	sn_array[4] =sn_obg4;
                            	sn_array[5] =sn_obg5;*/
                            	 var sn_array = [];
                            	
                                content.ps_sn_burn_fixed = $("#ps_sn_burn_fixed").val();
                                content.ps_sn_burn_nb = $("#ps_sn_burn_nb").val();
                                
                                if ((content.pr_type=="A511_no_and_has_sn"|| content.pr_type=="A511_has_sn") && 
                                	(content.pr_type=="A521_no_and_has_sn"|| content.pr_type=="A521_has_sn") && 
                                    (content.ps_sn_burn_fixed == "" || content.ps_sn_burn_nb=="")) {
                                    main.alertshow(true, "[流程卡][SN]尚未填寫完整,請再次檢查清楚!!");
                                    return;
                                }
                            }
                            content.ph_p_number = $("#ph_p_number").val();
                            content.ph_p_name = $("#ph_p_name").val();
                            content.sn = sn_array;

                            order = "production_search_update";
                            //檢查內容是否正確
                            if (content.mb_ver == "" || content.mb_ver_ecn == "" || content.nvram == "" || content.bios == "" || content.product_model_in == "" || content.ec == "" || content.os == "") {
                                main.alertshow(true, "[軟體定義]尚未填寫完整,請再次檢查清楚!!");
                                return;
                            }
                            if (
                                content.bom_id == "" ||
                                content.product_model == "" ||
                                content.version_motherboard == "" ||
                                content.bom_product_id == "" ||
                                content.production_quantity == "" ||
                                content.production_order_id == "" ||
                                content.production_client_name == "" ||
                                content.production_id == "" ||
                                $("#datepicker1 input").val() == "" ||
                                $("#datepicker2 input").val() == ""
                            ) {
                                main.alertshow(true, "[流程卡]尚未填寫完整,請再次檢查清楚!!");
                                return;
                            }
                        } else {
                            //沒勾選->不登記->不繼續
                            templateBody.printDiv2();
                            return;
                        }
                        url = "./production_progress_update.do";
                        break;
                    case "production": //查詢 製令單
                        order = "production_search";
                        content.production_id = $("#s_id").val();
                        content.product_model = $("#s_model2").val();
                        content.bom_product_id = $("#s_bom_number2").val();
                        content.product_progress = $("#s_history_production").val();
                        url = "./production_print.do";
                        break;
                }
                var data = JSON.stringify({
                    data: {
                        datetime: "",
                        action: "R",
                        whoami: main.loginData.account,
                        cellBackName: "bodyAfter",
                        cellBackOrder: order,
                        content: content,
                    },
                });
                main.ajaxSend(url, data);
            },
            createBarcode: function (code) {
                $("#barcodeOutput").barcode(code, "code39", {
                    barWidth: 2,
                    barHeight: 20,
                });
            },
            //產生回傳
            createBarcodeForPrint: function (code) {
                $("#barcodeOutputSn").barcode(code, "code39", {
                    barWidth: 1,
                    barHeight: 23,
                    fontSize: 10,
                });
                $("#barcodeOutputSn").css("transform", "scale(1.25)");
            },
            printDiv: function () {
                var divToPrint = document.getElementById("collapseAddedPrint");
                var style = document.getElementById("table2Style");
                var newWin = window.open("", "Print-Window");
                newWin.document.open();
                newWin.document.write(
                    "<html>" +
                        "<head>" +
                        '<link rel="stylesheet" href="./thirdparty/css/bootstrap-4.4.1.min.css" />' +
                        style.outerHTML +
                        "</head>" +
                        '<body onload="window.print()" class="container" id="main">' +
                        "<div>" +
                        divToPrint.innerHTML +
                        "</div>" +
                        "</body>" +
                        "</html>"
                );
                newWin.document.close();
                setTimeout(function () {
                    newWin.close();
                }, 2000);
            },
            printDiv2: function () {
                this.d_1 = $("#datepicker1 input").val();
                this.d_2 = $("#datepicker2 input").val();
                $("#datepicker1 input").addClass("d-none");
                $("#datepicker2 input").addClass("d-none");
                $("#datepicker1 div").removeClass("d-none");
                $("#datepicker2 div").removeClass("d-none");
                $("#datepicker1 div").text(this.d_1);
                $("#datepicker2 div").text(this.d_2);
                //設置數量
                var number_total = parseInt($("#p_number").text());
                if (this.sn_all_nb != null) this.createBarcodeForPrint(this.sn_all_nb[0]);
                var style = document.getElementById("table2Style");
                var newWin = ""; //= window.open("", "Print-Window");
                var divToPrint = "";
                var print_production = "";
                var print_page = 0; //有幾分頁
                var print_nb = 200; //每頁幾筆
                //每分頁延遲
                function print_Loop(new_nb, in_total, in_nb) {
                    setTimeout(function () {
                        //如果小於分頁數
                        var newWin = "";
                        if (in_total - new_nb < in_nb) {
                            in_nb = number_total - new_nb;
                        }
                        for (var i = 1; i <= in_nb; i++) {
                            if (templateBody.sn_all_nb != null) {
                                templateBody.createBarcodeForPrint(templateBody.sn_all_nb[new_nb + i - 1]);
                            }
                            divToPrint = document.getElementById("collapseAdded2");
                            if (i == 1 || i == print_nb * print_page + 1) {
                                //初始化-每分頁第一筆資料
                                newWin = window.open("", "Print-Window_" + new_nb);
                                print_page += 1;
                                print_production = "<div>" + divToPrint.innerHTML + "</div>";
                            } else {
                                print_production += '<div style="page-break-before:always">' + divToPrint.innerHTML + "</div>";
                            }
                            //分批列印
                            if (in_nb == i) {
                                newWin.document.open();
                                newWin.document.write(
                                    "<html><head>" +
                                        "<title>DTR ERP(" +
                                        (new_nb + 1) +
                                        " to " +
                                        (new_nb + in_nb) +
                                        ")</title>" +
                                        '<link rel="stylesheet" href="./thirdparty/css/bootstrap-4.4.1.min.css" />' +
                                        style.outerHTML +
                                        "</head>" +
                                        '<body onload="window.print()" class="container" id="main">' +
                                        print_production +
                                        "</body></html>"
                                );
                                newWin.document.close(); //完成頁面顯示
                                setTimeout(function () {
                                    newWin.close();
                                }, 6500);
                                //console.log(newWin.document.getElementById('datepicker1').getElementsByTagName("input"));
                            }
                        }
                        new_nb += in_nb;
                        //如果還沒跑完
                        if (new_nb < in_total) {
                            print_Loop(new_nb, in_total, in_nb);
                        } else {
                            //跑完的話(恢復日期格式)
                            $("#datepicker1 input").removeClass("d-none");
                            $("#datepicker2 input").removeClass("d-none");
                            $("#datepicker1 div").addClass("d-none");
                            $("#datepicker2 div").addClass("d-none");
                        }
                    }, 3000);
                }

                //初始化(現在數 0)/總筆數/每分頁數(100)
                //日期顯示
                $("#datepicker1 input").addClass("d-none");
                $("#datepicker2 input").addClass("d-none");
                $("#datepicker1 div").removeClass("d-none");
                $("#datepicker2 div").removeClass("d-none");
                print_Loop(0, number_total, print_nb);
            },
            //Rsp-回傳值-指令
            bodyAfter: function (event) {
                console.log("to index success");
                switch (event.r_cellBackOrder) {
                    case "search_update":
                        //刷新資料
                        if (event.r_content.templateInfo.body["list"] != null && event.r_content.templateInfo.body["list"] != "") {
                            this.group_list = main.contentData.templateInfo.body["group_list"];
                            this.item_list = main.contentData.templateInfo.body["item_list"];
                            this.search_list = main.contentData.templateInfo.body["list"];
                            this.search_update();
                        }
                        break;
                    //更新查詢
                    case "production_search_update":
                        if (event.r_content.templateInfo.body["production_list"] != null && event.r_content.templateInfo.body["production_list"] != "") {
                            this.production_list = main.contentData.templateInfo.body["production_list"];
                            this.softwareVer_list = main.contentData.templateInfo.body["softwareVer_list"];
                            //如果有克製化
                            if (main.contentData.templateInfo.body["sn_all_nb"]["sn_list_burn"] != null) {
                                this.sn_all_nb = main.contentData.templateInfo.body["sn_all_nb"]["sn_list_burn"];
                            } else {
                                this.sn_all_nb = main.contentData.templateInfo.body["sn_all_nb"]["sn_list"];
                            }
                            this.sn_all_list = main.contentData.templateInfo.body["sn_all_list"];
                            this.production_update();
                            templateBody.printDiv2();
                        }
                        break;
                    //只有查詢
                    case "production_search":
                        if (event.r_content.templateInfo.body["production_list"] != null && event.r_content.templateInfo.body["production_list"] != "") {
                            this.production_list = main.contentData.templateInfo.body["production_list"];
                            this.production_update();
                        }
                        break;
                }
            },
        },
        //移除監聽事件
        beforeDestroy: function () {
            console.log("to beforeDestroy event");
            $(document).off("click", "#a_u_group_name select");
            $(document).off("click", "#search_choose input");
            $(document).off("click", "#s_submit");
            $(document).off("click", "#s_submit2");
            $(document).off("click", "#a_c_submit");
            $(document).off("click", "#a_c_submit2");
            $(document).off("click", "#p_submit2");

            $(document).off("click", ".a_submit");
            $(document).off("click", ".a_submit2");
            $(document).off("click", "#s_l_submit");
            $(document).off("click", "#s_c_submit");
            $(document).off("change", "#s_g_item");
            $(document).off("click", "#a_item");
            $(document).off("click", ".a_i_item");
            $(document).off("click", ".from_move");
            $(document).off("click", ".production_ok");

            $(document).off("change", ".select_sn");

            $(document).off("focusout", "#client_name");
            $(document).off("focusout", "#barcodeInput");
            $(document).off("focusin", "#barcodeInput");
            $(document).off("keyup", "#barcodeInput");
            $(document).off("click", "#sn_customized_ok");
        },
    });
</script>
